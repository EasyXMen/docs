<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="../../../">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>CanTsyn &mdash; EasyXMen_docs 1.0.0 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="../../../genindex.html" />
            <link rel="search" title="Search" href="../../../search.html" />
            <link rel="top" title="EasyXMen_docs 1.0.0 documentation" href="#" />
            <link rel="next" title="Com" href="../Com/Com.html" />
            <link rel="prev" title="CanTp" href="../CanTp/CanTp.html" />
    </head>
<body>
    <script type="text/javascript" src="../../../_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../../../index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="../../../_static/img/xmen_logo.png" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        开源小满EasyXMen
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="../../../search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">参考手册:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Bfx/Bfx.html">Bfx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BswM/BswM.html">BswM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CanIf/CanIf.html">CanIf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CanNm/CanNm.html">CanNm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CanSM/CanSM.html">CanSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CanTp/CanTp.html">CanTp</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CanTsyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Com/Com.html">Com</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComM/ComM.html">ComM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Crc/Crc.html">Crc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Det/Det.html">Det</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CryIf/CryIf.html">CryIf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Crypto_62/Crypto_62.html">Crypto_62</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CsM/CsM.html">CsM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Dcm/Dcm.html">Dcm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Dem/Dem.html">Dem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Dlt/Dlt.html">Dlt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DoIP/DoIP.html">DoIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E2E/E2E.html">E2E</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EcuM/EcuM.html">EcuM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ea/Ea.html">Ea</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Eep_62/Eep_62.html">Eep_62</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EthIf/EthIf.html">EthIf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EthSM/EthSM.html">EthSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EthTrcv/EthTrcv.html">EthTrcv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EthTSyn/EthTSyn.html">EthTSyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fee/Fee.html">Fee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fim/Fim.html">Fim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FlashTest/FlashTest.html">FlsTst</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IpduM/IpduM.html">IpduM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IStdLib/IStdLib.html">IStdLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../KeyM/KeyM.html">KeyM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LdCom/LdCom.html">LdCom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LinIf/LinIf.html">LinIf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LinSM/LinSM.html">LinSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MemIf/MemIf.html">MemIf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MemMap/MemMap.html">MemMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MemLayout/MemLayout.html">MemLayout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Nm/Nm.html">Nm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NvM/NvM.html">NvM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Os/Os.html">Os</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PduR/PduR.html">PduR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RamTest/RamTest.html">RamTst</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rte/Rte.html">Rte</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iRte/iRte.html">iRte</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sd/Sd.html">Sd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SecOC/SecOC.html">SecOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SoAd/SoAd.html">SoAd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SomeIpTp/SomeIpTp.html">SomeIpTp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../StbM/StbM.html">StbM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TcpIp/TcpIp.html">TcpIp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UdpNm/UdpNm.html">UdpNm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WdgIf/WdgIf.html">WdgIf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WdgM/WdgM.html">WdgM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Xcp/Xcp.html">Xcp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tm/Tm.html">Tm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CDD_FVM/CDD_FVM.html">CDD_FVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EthSwt/EthSwt.html">EthSwt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CanTrcv/CanTrcv.html">CanTrcv</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">集成手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/BswM%26EcuM.html">BswM&amp;EcuM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/CAN.html">CAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/CANNM.html">CANNM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/CanTSyn.html">CanTSyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/DoIP.html">DoIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/E2E.html">E2E</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/Eth.html">Eth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/EthTSyn.html">EthTSyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/FlashTest.html">FlashTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/LinMaster.html">LinMaster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/LinSlave.html">LINSlave</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/NVM.html">NvM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/OBD.html">OBD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/RamTest.html">RamTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/SecOC.html">SecOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/SOMEIP.html">SOMEIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/UdpNm.html">UdpNm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/UDSonCAN.html">UDSOnCan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/UDSonLIN.html">UDSonLIN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/WDG.html">WDG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/XCP.html">XCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E9%9B%86%E6%88%90%E6%89%8B%E5%86%8C/%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84.html">总体架构</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">工程说明:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E8%AF%B4%E6%98%8E/RH850U2A16_R7F702300BFABA_C_Demo.html">RH850U2A16_R7F702300BFABA_C_Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E8%AF%B4%E6%98%8E/TC397_Demo.html">TC397_Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E8%AF%B4%E6%98%8E/S32K148_Demo.html">S32K148_Demo</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../../../index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">CanTsyn</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="../../../_sources/sub/参考手册/CanTsyn/CanTsyn.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="cantsyn">
<h1>CanTsyn<a class="headerlink" href="#cantsyn" title="Link to this heading">¶</a></h1>
<section id="document-information">
<h2>文档信息 Document Information<a class="headerlink" href="#document-information" title="Link to this heading">¶</a></h2>
<section id="version-history">
<h3>版本历史 Version History<a class="headerlink" href="#version-history" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>日期(Date)</p></th>
<th class="head"><p>作者(Author)</p></th>
<th class="head"><p>版本(Version)</p></th>
<th class="head"><p>状态(Status)</p></th>
<th class="head"><p>说明(Description)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2025/3/2</p></td>
<td><p>xiongfei.shi</p></td>
<td><p>V0.1</p></td>
<td><p>发布(Release)</p></td>
<td><p>首次发布(First release)</p></td>
</tr>
<tr class="row-odd"><td><p>2025/04/04</p></td>
<td><p>xiongfei.shi</p></td>
<td><p>V1.0</p></td>
<td><p>发布(Release)</p></td>
<td><p>正式发布(Official release)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="references">
<h3>参考文档 References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 50.0%" />
<col style="width: 16.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>编号(Number)</p></th>
<th class="head"><p>分类(Classification)</p></th>
<th class="head"><p>标题(Title)</p></th>
<th class="head"><p>版本(Version)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Autosar</p></td>
<td><p>AUTOSAR_CP_SWS_TimeSyncOverCAN.pdf</p></td>
<td><p>R23-11</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Autosar</p></td>
<td><p>AUTOSAR_CP_SWS_SynchronizedTimeBaseManager.pdf</p></td>
<td><p>R23-11</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="terms-and-abbreviations">
<h2>术语与简写 Terms and Abbreviations<a class="headerlink" href="#terms-and-abbreviations" title="Link to this heading">¶</a></h2>
<section id="terms">
<h3>术语 Terms<a class="headerlink" href="#terms" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>术语(Terms)</p></th>
<th class="head"><p>解释(Explanation)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Global Time Domain</p></td>
<td><p>全局时间域(Global Time Domain)</p></td>
</tr>
<tr class="row-odd"><td><p>Global Time Master</p></td>
<td><p>全域时间主控(Global Time Master)</p></td>
</tr>
<tr class="row-even"><td><p>Debounce Time</p></td>
<td><p>同一PDU两条发送消息的最小间隔(Minimum Interval between Two Transmissions of the Same PDU)</p></td>
</tr>
<tr class="row-odd"><td><p>SYNC message</p></td>
<td><p>时间同步消息(Time synchronization message)</p></td>
</tr>
<tr class="row-even"><td><p>FUP message</p></td>
<td><p>后续消息(Subsequent Message)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="abbreviations">
<h3>简写 Abbreviations<a class="headerlink" href="#abbreviations" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 33.3%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>简写(Abbreviation)</p></th>
<th class="head"><p>全称(Full name)</p></th>
<th class="head"><p>解释(Explanation)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>&lt;Bus&gt;TSyn</p></td>
<td><p>A bus specific Time Synchronization module</p></td>
<td><p>特定总线时间同步模块</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn</p></td>
<td><p>Time Synchronization module for CAN</p></td>
<td><p>CAN 时间同步模块</p></td>
</tr>
<tr class="row-even"><td><p>CRC</p></td>
<td><p>Cyclic Redundancy Checksum</p></td>
<td><p>循环冗余检验</p></td>
</tr>
<tr class="row-odd"><td><p>DET</p></td>
<td><p>Default Error Tracer</p></td>
<td><p>默认错误跟踪器</p></td>
</tr>
<tr class="row-even"><td><p>DLC</p></td>
<td><p>Data Length Code</p></td>
<td><p>数据长度代码</p></td>
</tr>
<tr class="row-odd"><td><p>StbM</p></td>
<td><p>Synchronized Time-Base Manager</p></td>
<td><p>同步的时间基管理</p></td>
</tr>
<tr class="row-even"><td><p>TS</p></td>
<td><p>Time Slave</p></td>
<td><p>时间从属</p></td>
</tr>
<tr class="row-odd"><td><p>Timesync</p></td>
<td><p>Time Synchronization</p></td>
<td><p>时间同步</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="introduction">
<h2>简介 Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>CanTSyn 在 AutoSAR 软件层级架构如下图， 其所属于时间同步栈。</p>
<p>The software layer architecture of StbM in AutoSAR is shown in the figure below. It belongs to the time synchronization stack.</p>
<figure class="align-center" id="cantsyn-fig-arch">
<img alt="CanTSyn在AUTOSAR中的位置(Position of CanTSyn in AUTOSAR))" src="../../../_images/CanTSyn_In_AutoSAR.png" />
<figcaption>
<p><span class="caption-text">CanTSyn 在 AUTOSAR 中的位置 (Position of CanTSyn in AUTOSAR)</span><a class="headerlink" href="#cantsyn-fig-arch" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>本文中描述CanTSyn，StbM负责管理时间域，给CanTSyn提供接口用来更新同步时间，给其他用户提供接口用来获取/通知同步时间。CanTSyn负责Can总线上的时间同步。</p>
<p>As described in this document, CanTSyn works with StbM. StbM is responsible for managing the time domain, providing an interface for CanTSyn to update the synchronized time, and providing interfaces for other users to get/notify the synchronized time. CanTSyn is responsible for time synchronization over the CAN bus.</p>
</section>
<section id="functional-description">
<h2>功能描述 Functional Description<a class="headerlink" href="#functional-description" title="Link to this heading">¶</a></h2>
<p>CanTSyn模块和StbM模块息息相关，StbM模块提供了时间同步的功能和时钟实例，但不负责在各个总线内的时间分发任务。那么CanTSyn模块就处理了在CAN总线发放时间信息的任务。</p>
<p>The CanTSyn module is closely related to the StbM module. The StbM module provides time synchronization function and clock instances but is not responsible for the task of time distribution on individual buses. Therefore, the CanTSyn module handles the task of distributing time information on the CAN bus.</p>
<p>仅仅通过广播的方式把时间信息从Time Masters发送到Time Slaves会导致时间不精准，这是因为CAN总线传输仲裁机制以及BSW的延迟。</p>
<p>Simply broadcasting time information from Time Masters to Time Slaves may lead to inaccuracies due to the CAN bus arbitration mechanism and BSW latency.</p>
<p>具体实现上我们通过以下的两步算法来尽可能消除这样的延迟：</p>
<p>In practice, this latency is minimized by implementing the following two-step algorithm:</p>
<p>第一步：发送方(Time Master)首先记录当前的同步时间(SYNC)以及本地时间(T0VLT)并在第一个广播信息(所谓的SYNC信息)里，把同步好的时间的秒部分(SYNCSEC)作为内容发送。</p>
<p>Step 1: The sender (Time Master) first records the current synchronized time (SYNC) and the local time (T0VLT), and in the first broadcast message (the SYNC message), sends the seconds part of the synchronized time (SYNCSEC).</p>
<p>发送方在收到 “CAN transmit confirmation”时记录时间戳来得到信息实际发送的时间点(T1VLT)。接收方(Time Slave)收到信息 “CAN receive indication”时记录时间戳来检测信息实际收到的时间点(T2VLT)。</p>
<p>The sender records the timestamp Upon receiving “CAN transmit confirmation” to get the actual transmission time of the message (T1VLT). The receiver (Time Slave) records the timestamp upon receiving “CAN receive indication” to detect the actual time the message was received (T2VLT).</p>
<p>第二步：在第二个同步信息(所谓的FUP(follow-up)信息)里，发送方发送T4作为内容，T4为SYNC消息准备发送和实际发送的时间差(T1VLT-T0VLT)加上T0SYNCNS(同步时间的纳秒部分)(T4=T0SYNCNS+(T1VLT-T0VLT))。对于发送方来说，此时T0SYNCSEC+T4就为同步时间。Time Slave现在从SYNC和FUP消息里获取了足够的信息，再加上先前记录的时间戳T2VLT，就可以确定更加确切的时间信息。接收方将(T0SYNCSEC+T4)和T2VLT时间对信息传给StbM, StbM即可计算同步时间，完成一次Time Master和Time Slave之间的时间同步。</p>
<p>Step 2: In the second synchronization message (the FUP, or follow-up, message), the sender transmits T4 as the content. T4 is the difference between the intended and actual transmission time of the SYNC message (T1VLT - T0VLT), plus the nanoseconds part of the synchronized time (T0SYNCNS). Thus, T4 = T0SYNCNS + (T1VLT - T0VLT). For the sender, the synchronized time at this point is T0SYNCSEC + T4. Time Slave now has obtained sufficient information from the SYNC and FUP messages, and along with its previously recorded timestamp T2VLT, it can determine a more precise time. The receiver passes the time pair information, (T0SYNCSEC + T4) and T2VLT, to StbM. StbM can then calculate the synchronized time, completing the time synchronization cycle between Time Master and Time Slave.</p>
<section id="features">
<h3>特性 Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h3>
<section id="message-format">
<h4>消息格式 Message Format<a class="headerlink" href="#message-format" title="Link to this heading">¶</a></h4>
<p>CanTSyn的协议格式即支持标准CAN模式也支持扩展CAN模式。</p>
<p>The protocol format of CanTSyn supports both standard CAN and extended CAN modes.</p>
</section>
<section id="time-synchronization-master">
<h4>时间同步主站 Time Synchronization Master<a class="headerlink" href="#time-synchronization-master" title="Link to this heading">¶</a></h4>
<p>CanTSyn支持配置为时间主站，将时间同步给同网络下的其他时间从站。</p>
<p>CanTSyn can be configured as a Time Master to synchronize time with other Time Slaves on the same network.</p>
</section>
<section id="time-synchronization-slave">
<h4>时间同步从站 Time Synchronization Slave<a class="headerlink" href="#time-synchronization-slave" title="Link to this heading">¶</a></h4>
<p>CanTSyn支持配置为时间从站，接受同网络下的时间主机的同步消息，将自己的时间与主站同步。</p>
<p>CanTSyn can be configured as a Time Slave to receive synchronization messages from the Time Master on the same network and synchronize its own time with the master’s time.</p>
</section>
</section>
<section id="deviation">
<h3>偏差 Deviation<a class="headerlink" href="#deviation" title="Link to this heading">¶</a></h3>
<p>1.不再支持偏移时间的同步，配置中删除CanTSynGlobalTimeOfsDataIDList配置项和CanTSynGlobalTimeOfnsDataIDList配置项</p>
<p>1.Synchronization of offset time is no longer supported; the CanTSynGlobalTimeOfsDataIDList and CanTSynGlobalTimeOfnsDataIDList configuration items have been removed.</p>
<p>2.不支持CAN的硬件时间戳</p>
<p>2.CAN hardware timestamps are not supported.</p>
<p>3.不支持时间验证功能</p>
<p>3.Time verification function is not supported</p>
<p>4.不支持数据完整性检查功能(ICV)</p>
<p>4.The data integrity check function (ICV) is not supported.</p>
</section>
<section id="extension">
<h3>扩展 Extension<a class="headerlink" href="#extension" title="Link to this heading">¶</a></h3>
<p>None</p>
</section>
</section>
<section id="integration">
<h2>集成 Integration<a class="headerlink" href="#integration" title="Link to this heading">¶</a></h2>
<section id="file-list">
<h3>文件列表 File List<a class="headerlink" href="#file-list" title="Link to this heading">¶</a></h3>
<section id="static-files">
<h4>静态文件 Static Files<a class="headerlink" href="#static-files" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>文件(File)</p></th>
<th class="head"><p>描述(Description)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CanTSyn.h</p></td>
<td><p>包含需要使用的宏定义，类型定义，配置结构体声明，外部函数声明(Contains macro definitions, type definitions, configuration structure declarations, and external function declarations that need to be used)</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_Cbk.h</p></td>
<td><p>包含需要使用的宏定义，类型定义，配置结构体声明，外部回调函数声明(Contains macro definitions, type definitions, configuration structure declarations, and external callback function declarations that need to be used)</p></td>
</tr>
<tr class="row-even"><td><p>CanTSyn_Internal.h</p></td>
<td><p>包含需要使用的内部宏定义，内部类型定义，外部数据声明和外部函数声明(Contains internal macro definitions, internal type definitions, external data declarations, and external function declarations that need to be used)</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn.c</p></td>
<td><p>包含需要使用的宏定义，内部变量，内部函数，全局函数(Contains macro definitions, internal variables, internal functions, and global functions that need to be used)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dynamic-files">
<h4>动态文件 Dynamic Files<a class="headerlink" href="#dynamic-files" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>文件(File)</p></th>
<th class="head"><p>描述(Description)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CanTSyn_MemMap.h</p></td>
<td><p>CanTSyn模块的内存映射(Memory mapping of the CanTrcv module)</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_Cfg.h</p></td>
<td><p>定义CanTSyn模块预编译时用到的配置参数(Defines configuration parameters used in the pre-compilation of the CanTSyn module)</p></td>
</tr>
<tr class="row-even"><td><p>CanTSyn_Cfg.c</p></td>
<td><p>CanTSyn Pre-Compile 配置源文件(Pre-Compile configuration source file of CanTSyn)</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_PBcfg.c</p></td>
<td><p>CanTSyn Post-Build 配置源文件(Post-Build configuration source file of CanTSyn)</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="error-handling">
<h3>错误处理 Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h3>
<section id="development-errors">
<h4>开发错误 Development Errors<a class="headerlink" href="#development-errors" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 16.7%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Error code</p></th>
<th class="head"><p>Value[hex]</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CANTSYN_E_INVALID_PDUID</p></td>
<td><p>0x01</p></td>
<td><p>API service called with wrong PDU or SDU</p></td>
</tr>
<tr class="row-odd"><td><p>CANTSYN_E_UNINIT</p></td>
<td><p>0x02</p></td>
<td><p>API service used in un-initialized state</p></td>
</tr>
<tr class="row-even"><td><p>CANTSYN_E_NULL_POINTER</p></td>
<td><p>0x03</p></td>
<td><p>A pointer is NULL</p></td>
</tr>
<tr class="row-odd"><td><p>CANTSYN_E_INIT_FAILED</p></td>
<td><p>0x04</p></td>
<td><p>CanTSyn initialization failed</p></td>
</tr>
<tr class="row-even"><td><p>CANTSYN_E_PARAM</p></td>
<td><p>0x05</p></td>
<td><p>API called with invalid parameter</p></td>
</tr>
<tr class="row-odd"><td><p>CANTSYN_E_INV_CTRL_IDX</p></td>
<td><p>0x06</p></td>
<td><p>Invalid Controller index</p></td>
</tr>
<tr class="row-even"><td><p>CANTSYN_E_INVALID_PARTITION</p></td>
<td><p>0xF0</p></td>
<td><p>CanTSyn accessed by wrong partition</p></td>
</tr>
<tr class="row-odd"><td><p>CANTSYN_E_ALREADY_INITIALIZED</p></td>
<td><p>0xF1</p></td>
<td><p>CanTSyn has initialized</p></td>
</tr>
</tbody>
</table>
</section>
<section id="product-errors">
<h4>产品错误 Product Errors<a class="headerlink" href="#product-errors" title="Link to this heading">¶</a></h4>
<p>None</p>
</section>
<section id="runtime-errors">
<h4>运行时错误 Runtime Errors<a class="headerlink" href="#runtime-errors" title="Link to this heading">¶</a></h4>
<p>None</p>
</section>
</section>
</section>
<section id="interface-description">
<h2>接口描述 Interface Description<a class="headerlink" href="#interface-description" title="Link to this heading">¶</a></h2>
<section id="type-definitions">
<h3>类型定义 Type Definitions<a class="headerlink" href="#type-definitions" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.3%" />
<col style="width: 9.1%" />
<col style="width: 60.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CanTSyn_ConfigType</p></td>
<td><p>struct</p></td>
<td><p>This is the base type for the configuration of the Time Synchronization over CAN.</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_TransmissionModeType</p></td>
<td><p>enum</p></td>
<td><p>Handles the enabling and disabling of the transmission mode.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="services">
<h3>提供的服务 Services<a class="headerlink" href="#services" title="Link to this heading">¶</a></h3>
<section id="cantsyn-init">
<h4>CanTSyn_Init<a class="headerlink" href="#cantsyn-init" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">CanTSyn_Init</span><span class="p">(</span><span class="n">const</span> <span class="n">CanTSyn_ConfigType</span> <span class="o">*</span><span class="n">configPtr</span><span class="p">)</span>
</pre></div>
</div>
<p>This function initializes the Time Synchronization over CAN.</p>
<dl class="simple">
<dt><strong>Sync/Async</strong></dt><dd><p>Synchronous</p>
</dd>
<dt><strong>Reentrancy</strong></dt><dd><p>Non Reentrant</p>
</dd>
</dl>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dir</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[in]</p></td>
<td><p>configPtr</p></td>
<td><p>Pointer to selected configuration structure</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt><strong>Return type</strong></dt><dd><p>void</p>
</dd>
</dl>
</section>
<section id="cantsyn-getversioninfo">
<h4>CanTSyn_GetVersionInfo<a class="headerlink" href="#cantsyn-getversioninfo" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">CanTSyn_GetVersionInfo</span><span class="p">(</span><span class="n">Std_VersionInfoType</span> <span class="o">*</span><span class="n">versioninfoPtr</span><span class="p">)</span>
</pre></div>
</div>
<p>This service returns the version information of this module.</p>
<dl class="simple">
<dt><strong>Sync/Async</strong></dt><dd><p>Synchronous</p>
</dd>
<dt><strong>Reentrancy</strong></dt><dd><p>Non Reentrant</p>
</dd>
</dl>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dir</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[out]</p></td>
<td><p>versioninfoPtr</p></td>
<td><p>See Std_VersionInfoType</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt><strong>Return type</strong></dt><dd><p>void</p>
</dd>
</dl>
</section>
<section id="cantsyn-settransmissionmode">
<h4>CanTSyn_SetTransmissionMode<a class="headerlink" href="#cantsyn-settransmissionmode" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">CanTSyn_SetTransmissionMode</span><span class="p">(</span><span class="n">uint8</span> <span class="n">CtrlIdx</span><span class="p">,</span> <span class="n">CanTSyn_TransmissionModeType</span> <span class="n">Mode</span><span class="p">)</span>
</pre></div>
</div>
<p>This API is used to turn on and off the TX capabilities of the CanTSyn.</p>
<dl class="simple">
<dt><strong>Sync/Async</strong></dt><dd><p>Synchronous</p>
</dd>
<dt><strong>Reentrancy</strong></dt><dd><p>Non Reentrant</p>
</dd>
</dl>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dir</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[in]</p></td>
<td><p>CtrlIdx</p></td>
<td><p>Index of the CAN channel</p></td>
</tr>
<tr class="row-odd"><td><p>[in]</p></td>
<td><p>Mode</p></td>
<td><p>CANTSYN_TX_OFF CANTSYN_TX_ON</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt><strong>Return type</strong></dt><dd><p>void</p>
</dd>
</dl>
</section>
</section>
<section id="id1">
<h3>类型定义 Type Definitions<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>None</p>
</section>
<section id="id2">
<h3>提供的服务 Services<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<section id="cantsyn-rxindication">
<h4>CanTSyn_RxIndication<a class="headerlink" href="#cantsyn-rxindication" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">CanTSyn_RxIndication</span><span class="p">(</span><span class="n">PduIdType</span> <span class="n">RxPduId</span><span class="p">,</span> <span class="n">const</span> <span class="n">PduInfoType</span> <span class="o">*</span><span class="n">PduInfoPtr</span><span class="p">)</span>
</pre></div>
</div>
<p>Indication of a received PDU from a lower layer communication interface module.</p>
<dl class="simple">
<dt><strong>Sync/Async</strong></dt><dd><p>Synchronous</p>
</dd>
<dt><strong>Reentrancy</strong></dt><dd><p>Reentrant(Reentrant for different PduIds. Non reentrant for the same PduId.)</p>
</dd>
</dl>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dir</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[in]</p></td>
<td><p>RxPduId</p></td>
<td><p>ID of the received PDU.</p></td>
</tr>
<tr class="row-odd"><td><p>[in]</p></td>
<td><p>PduInfoPtr</p></td>
<td><p>Contains the length (SduLength) of the received PDU, a pointer to a buffer (SduDataPtr) containing the PDU, and the MetaData related to this PDU.</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt><strong>Return type</strong></dt><dd><p>void</p>
</dd>
</dl>
</section>
<section id="cantsyn-txconfirmation">
<h4>CanTSyn_TxConfirmation<a class="headerlink" href="#cantsyn-txconfirmation" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">CanTSyn_TxConfirmation</span><span class="p">(</span><span class="n">PduIdType</span> <span class="n">TxPduId</span><span class="p">,</span> <span class="n">Std_ReturnType</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>The lower layer communication interface module confirms the transmission of a PDU, or the failure to transmit a PDU.</p>
<dl class="simple">
<dt><strong>Sync/Async</strong></dt><dd><p>Synchronous</p>
</dd>
<dt><strong>Reentrancy</strong></dt><dd><p>Reentrant(Reentrant for different PduIds. Non reentrant for the same PduId.)</p>
</dd>
</dl>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dir</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[in]</p></td>
<td><p>TxPduId</p></td>
<td><p>ID of the PDU that has been transmitted.</p></td>
</tr>
<tr class="row-odd"><td><p>[in]</p></td>
<td><p>result</p></td>
<td><p>E_OK: The PDU was transmitted. E_NOT_OK: Transmission of the PDU failed.</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt><strong>Return type</strong></dt><dd><p>void</p>
</dd>
</dl>
</section>
</section>
<section id="id3">
<h3>类型定义 Type Definitions<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.3%" />
<col style="width: 9.1%" />
<col style="width: 60.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CanTSyn_MasterTimeInfoType</p></td>
<td><p>struct</p></td>
<td><p>store the time information for a time master</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_SlaveTimeInfoType</p></td>
<td><p>struct</p></td>
<td><p>store the time information for a time slave</p></td>
</tr>
<tr class="row-even"><td><p>CanTSyn_GlobalTimeMasterType</p></td>
<td><p>struct</p></td>
<td><p>define configuration of the global time master</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_GlobalTimeSlaveType</p></td>
<td><p>struct</p></td>
<td><p>define configuration of the global time slave</p></td>
</tr>
<tr class="row-even"><td><p>CanTSyn_DataIDListElementType</p></td>
<td><p>struct</p></td>
<td><p>define DataIDList messages</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_GlobalTimeDomainType</p></td>
<td><p>struct</p></td>
<td><p>define CanTSyn GlobalTimeDomain</p></td>
</tr>
<tr class="row-even"><td><p>CanTSyn_InitStatusType</p></td>
<td><p>enum</p></td>
<td><p>define CanTSyn module initiation status</p></td>
</tr>
<tr class="row-odd"><td><p>CanTSyn_MasterStatusType</p></td>
<td><p>enum</p></td>
<td><p>define CanTSyn master operation status</p></td>
</tr>
<tr class="row-even"><td><p>CanTSyn_SlaveStatusType</p></td>
<td><p>enum</p></td>
<td><p>define CanTSyn Slave operation Status</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-function">
<h3>配置函数 Configuration function<a class="headerlink" href="#configuration-function" title="Link to this heading">¶</a></h3>
<section id="cantsyn-mainfunction">
<h4>CanTSyn_MainFunction<a class="headerlink" href="#cantsyn-mainfunction" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">CanTSyn_MainFunction</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
</pre></div>
</div>
<p>This function needs to be called periodically to perform the AUTOSAR CanTSyn activities.</p>
<dl class="simple">
<dt><strong>Sync/Async</strong></dt><dd><p>Asynchronous</p>
</dd>
<dt><strong>Reentrancy</strong></dt><dd><p>Reentrant (Reentrant for different partitions. Non reentrant for the same partition.)</p>
</dd>
<dt><strong>Return type</strong></dt><dd><p>void</p>
</dd>
</dl>
</section>
</section>
<section id="applicable-services">
<h3>依赖的服务 Applicable Services<a class="headerlink" href="#applicable-services" title="Link to this heading">¶</a></h3>
<section id="compulsory-interface">
<h4>强制接口 Compulsory interface<a class="headerlink" href="#compulsory-interface" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 22.2%" />
<col style="width: 11.1%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>API Function</p></th>
<th class="head"><p>Header File</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>StbM_GetCurrentTime</p></td>
<td><p>StbM.h</p></td>
<td><p>Returns a time value(Local Time Base derived from Global Time Base) in standard format.</p></td>
</tr>
<tr class="row-odd"><td><p>StbM_GetTimeBaseUpdateCounter</p></td>
<td><p>StbM.h</p></td>
<td><p>Get the time base update counter value, that indicates a Time Base update to the Timesync Modules.</p></td>
</tr>
<tr class="row-even"><td><p>StbM_GetTimeBaseStatus</p></td>
<td><p>StbM.h</p></td>
<td><p>Returns detailed status information for a Synchronized(or Pure Local) Time Base.</p></td>
</tr>
<tr class="row-odd"><td><p>StbM_GetCurrentVirtualLocalTime</p></td>
<td><p>StbM.h</p></td>
<td><p>Returns the Virtual Local Time of the referenced Time Base..</p></td>
</tr>
<tr class="row-even"><td><p>CanIf_Transmit</p></td>
<td><p>CanIf.h</p></td>
<td><p>Requests transmission of a PDU.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="optional-interface">
<h4>可选接口 Optional Interface<a class="headerlink" href="#optional-interface" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 22.2%" />
<col style="width: 11.1%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>API Function</p></th>
<th class="head"><p>Header File</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Det_ReportError</p></td>
<td><p>Det.h</p></td>
<td><p>Service to report development errors.</p></td>
</tr>
<tr class="row-odd"><td><p>Crc_CalculateCRC8H2F</p></td>
<td><p>Crc.h</p></td>
<td><p>Calculate CRC value.</p></td>
</tr>
<tr class="row-even"><td><p>GetApplicationID</p></td>
<td><p>Os.h</p></td>
<td><p>Get application ID.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-interfaces">
<h4>配置接口 Configuration Interfaces<a class="headerlink" href="#configuration-interfaces" title="Link to this heading">¶</a></h4>
<p>None</p>
</section>
</section>
</section>
<section id="configuration">
<h2>配置 Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<p>1.各CanTSynGlobalTimeDomain的CanTSynGlobalTimeDomainId是唯一的，不能出现相同。</p>
<p>1.CanTSynGlobalTimeDomainId for each CanTSynGlobalTimeDomain must be unique.</p>
<p>2.如果使能了CRC校验，那么相同CanTSynGlobalTimeDomainId的Master和Slave的CanTSynGlobalTimeSyncDataIDList、CanTSynGlobalTimeFupDataIDListElement配置项必须相同，否则校验不过。</p>
<p>2.If CRC checksum is enabled, CanTSynGlobalTimeSyncDataIDList and CanTSynGlobalTimeFupDataIDListElement configuration items must be identical for the Master and Slave within the same CanTSynGlobalTimeDomainId; otherwise, the check will fail.</p>
<figure class="align-center">
<img alt="CanTSyn_1" src="../../../_images/CanTSyn_1.png" />
</figure>
<p>配置主函数周期。</p>
<p>Configure the main function period.</p>
<p>Master配置</p>
<p>Master Configuration</p>
<p>BSW部分</p>
<p>BSW Part</p>
<p>导入萃取文件前</p>
<p>Before Importing the Extraction File</p>
<p>注意：萃取文件更新步骤参考下文SWC部分</p>
<p>Note: For the steps to update the extraction file, refer to the SWC part below.</p>
<figure class="align-center">
<img alt="CanTSyn_2" src="../../../_images/CanTSyn_2.png" />
</figure>
<p>右键新增一个时间域。</p>
<p>Right-click to add a new time domain.</p>
<figure class="align-center">
<img alt="CanTSyn_3" src="../../../_images/CanTSyn_3.png" />
</figure>
<p>1.配置CanTSynGlobalTimeDomainId时间域的ID。(主从时间域ID必须一致才可进行同步，用于划分不同的同步局域网)</p>
<p>1.Configure the time domain ID CanTSynGlobalTimeDomainId. (The Master and Slave time domain IDs must be identical for synchronization. This is used to create separate synchronization networks.)</p>
<p>2.关联时间基。</p>
<p>2.Associate the time base.</p>
<p>3.关联CAN控制器。</p>
<p>3.Associate the CAN controller.</p>
<figure class="align-center">
<img alt="CanTSyn_3" src="../../../_images/CanTSyn_3.png" />
</figure>
<p>1.设置CanTSynCyclicMsgResumeTime时间，指从立即发送恢复到循环发送所需要的时间。</p>
<p>1.Set CanTSynCyclicMsgResumeTime, which specifies the time required to transition from immediate transmission back to cyclic transmission.</p>
<p>2.设置CanTSynGlobalTimeDebounceTime，指SYNC报文和FU报文之间的时间间隔。</p>
<p>2.Set CanTSynGlobalTimeDebounceTime, which specifies the time interval between the SYNC and FUP messages.</p>
<p>3.CanTSynGlobalTimeTxCrcSecured可选择支持或不支持CRC校验。(CRC校验会校验报文中的sequenceID，DomainID等信息)此处选择不支持。注意：若选择支持，则需要配置CanTSynGlobalTimeFupDataIDList和CanTSynGlobalTimeSyncDataIDList。</p>
<p>3.Set CanTSynGlobalTimeTxCrcSecured to either enable or disable CRC checksum. (CRC checksum checks information in the message such as the sequence ID and Domain ID). Here, it is set to disabled. Note: If enabled, CanTSynGlobalTimeFupDataIDList and CanTSynGlobalTimeSyncDataIDList must be configured.</p>
<p>4.设置同步报文的发送周期CanTSynGlobalTimeTxPeriod。</p>
<p>4.Set the transmission period for synchronization messages CanTSynGlobalTimeTxPeriod.</p>
<p>导入萃取文件后</p>
<p>After Importing the Extraction File</p>
<p>完成更新萃取文件后，按照以下步骤生成RTE</p>
<p>After updating the extraction file, follow the steps below to generate the RTE.</p>
<figure class="align-center">
<img alt="CanTSyn_4" src="../../../_images/CanTSyn_4.png" />
</figure>
<p>首先打开ECUC模块，在上图位置添加之前在SWC新增的应用组件。</p>
<p>First, open the ECUC module and add the application component previously created in the SWC, as shown in the figure above.</p>
<figure class="align-center">
<img alt="CanTSyn_5" src="../../../_images/CanTSyn_5.png" />
</figure>
<p>右键ECUC模块，同步一下模块。</p>
<p>Right-click the ECUC module and synchronize the module.</p>
<figure class="align-center">
<img alt="CanTSyn_6" src="../../../_images/CanTSyn_6.png" />
</figure>
<p>点金同步RTE/OS。</p>
<p>Click to synchronize RTE/OS.</p>
<figure class="align-center">
<img alt="CanTSyn_7" src="../../../_images/CanTSyn_7.png" />
</figure>
<figure class="align-center">
<img alt="CanTSyn_8" src="../../../_images/CanTSyn_8.png" />
</figure>
<p>生成RTE文件和APP文件。</p>
<p>Generate the RTE and APP files.</p>
<p>SWC部分</p>
<p>SWC Part</p>
<p>作为主时钟，需要将自己的本地时间基信息发送到总线上，在这之前需要设置主时钟关联的时间基。因此需要走SWC，通过StbM的服务组件设置时间基。</p>
<p>As a master clock, it needs to send its local time base information to the bus. Before doing so, the time base associated with the master clock must be set. Therefore, this is done through SWC by setting the time base via the StbM service component.</p>
<figure class="align-center">
<img alt="CanTSyn_9" src="../../../_images/CanTSyn_9.png" />
</figure>
<p>如上图所示，在Application Component处右键新增一个应用组件。</p>
<p>As shown in the figure above, right-click on Application Component to add a new application component.</p>
<figure class="align-center">
<img alt="CanTSyn_10" src="../../../_images/CanTSyn_10.png" />
</figure>
<p>对该APP组件进行命名。</p>
<p>Name this APP component.</p>
<figure class="align-center">
<img alt="CanTSyn_11" src="../../../_images/CanTSyn_11.png" />
</figure>
<p>右键新增一个客户端Port。</p>
<p>Right-click to add a new client Port.</p>
<figure class="align-center">
<img alt="CanTSyn_12" src="../../../_images/CanTSyn_12.png" />
</figure>
<p>选中CanTSyn关联的时间基。</p>
<p>Select the time base associated with CanTSyn.</p>
<figure class="align-center">
<img alt="CanTSyn_13" src="../../../_images/CanTSyn_13.png" />
</figure>
<p>点击上图所示Runnable Entity List。</p>
<p>Click Runnable Entity List, as shown in the figure above.</p>
<figure class="align-center">
<img alt="CanTSyn_14" src="../../../_images/CanTSyn_14.png" />
</figure>
<p>New一个Init Runnable。</p>
<p>Create a new Init Runnable.</p>
<figure class="align-center">
<img alt="CanTSyn_15" src="../../../_images/CanTSyn_15.png" />
</figure>
<figure class="align-center">
<img alt="CanTSyn_16" src="../../../_images/CanTSyn_16.png" />
</figure>
<p>选择Access Points中的SetGlobalTime。</p>
<p>Select SetGlobalTime from the Access Points.</p>
<figure class="align-center">
<img alt="CanTSyn_17" src="../../../_images/CanTSyn_17.png" />
</figure>
<figure class="align-center">
<img alt="CanTSyn_18" src="../../../_images/CanTSyn_18.png" />
</figure>
<p>如上图所示开启图形界面。</p>
<p>Open the graphical interface, as shown in the figure above.</p>
<figure class="align-center">
<img alt="CanTSyn_19" src="../../../_images/CanTSyn_19.png" />
</figure>
<p>双击ECU_ComPosition。</p>
<p>Double-click ECU_Composition.</p>
<figure class="align-center">
<img alt="CanTSyn_20" src="../../../_images/CanTSyn_20.png" />
</figure>
<p>实例化TSyn_App。</p>
<p>Instantiate TSyn_App.</p>
<figure class="align-center">
<img alt="CanTSyn_21" src="../../../_images/CanTSyn_21.png" />
</figure>
<p>再次右键ECU_ComPosition打开图形化界面。</p>
<p>Right-click ECU_Composition again to open the graphical interface.</p>
<figure class="align-center">
<img alt="CanTSyn_22" src="../../../_images/CanTSyn_22.png" />
</figure>
<p>在空白处右键选择连接模式。</p>
<p>Right-click in the empty area and select the connection mode.</p>
<figure class="align-center">
<img alt="CanTSyn_23" src="../../../_images/CanTSyn_23.png" />
</figure>
<p>将StbM组件和TSynApp组件连接。</p>
<p>Connect the StbM component and the TSynApp component.</p>
<figure class="align-center">
<img alt="CanTSyn_24" src="../../../_images/CanTSyn_24.png" />
</figure>
<p>双击SysTem进入映射界面。</p>
<p>Double-click System to enter the mapping interface.</p>
<figure class="align-center">
<img alt="CanTSyn_25" src="../../../_images/CanTSyn_25.png" />
</figure>
<p>将ECU_Composition左键拖入ECU下，完成映射。</p>
<p>Drag ECU_Composition with the left mouse button under the ECU to complete the mapping.</p>
<figure class="align-center">
<img alt="CanTSyn_26" src="../../../_images/CanTSyn_26.png" />
</figure>
<p>点击上方箭头处进行校验。在下方箭头处查看是否有报错。若无报错，则可按照下图进行萃取。</p>
<p>Click the arrow at the top to perform verification. Check the area indicated by the arrow below for any errors. If there are no errors, proceed with extraction as shown in the figure below.</p>
<figure class="align-center">
<img alt="CanTSyn_27" src="../../../_images/CanTSyn_27.png" />
</figure>
<p>如上图所示，在ECU处右键创建萃取文件。</p>
<p>As shown in the figure above, right-click the ECU to create the extraction file.</p>
<figure class="align-center">
<img alt="CanTSyn_28" src="../../../_images/CanTSyn_28.png" />
</figure>
<p>替换到原有工程下的萃取文件。</p>
<p>Replace the existing extraction file in the project directory.</p>
<p>Slave配置</p>
<p>Slave Configuration</p>
<figure class="align-center">
<img alt="CanTSyn_29" src="../../../_images/CanTSyn_29.png" />
</figure>
<p>CanTSynGlobalTimeDomain配置与Master一致。区别在于需要设置的是CanTSynGlobalTimeSlave。</p>
<p>The CanTSynGlobalTimeDomain configuration is the same as that of the Master. The difference is that CanTSynGlobalTimeSlave needs to be configured.</p>
<figure class="align-center">
<img alt="CanTSyn_30" src="../../../_images/CanTSyn_30.png" />
</figure>
<p>1.设置FU报文的接收超时。指在这个时间内必须收到FU报文，否则丢弃。</p>
<p>1.Set the reception timeout for FUP messages. This means that the FUP message must be received within this time; otherwise, it is discarded.</p>
<p>2.设置CanTSynGlobalTimeSequenceCounterJumpWidth，指报文中的序列号SequenceCounter允许跳变的最大值，即可接受的最大丢帧数。</p>
<p>2.Set CanTSynGlobalTimeSequenceCounterJumpWidth, which specifies the maximum allowed jump for SequenceCounter in the message, i.e., the maximum number of acceptable lost frames.</p>
<p>3.由于不设置CRC校验，因此CanTSynRxCrcValidated需要设置为CRC_IGNORED。</p>
<p>3.Since CRC checksum is not being used, CanTSynRxCrcValidated must be set to CRC_IGNORED.</p>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="../CanTp/CanTp.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>CanTp
    </a>
    <a class="float-right" href="../Com/Com.html" title="Next">
        Com <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">CanTsyn</a><ul>
<li><a class="reference internal" href="#document-information">文档信息 Document Information</a><ul>
<li><a class="reference internal" href="#version-history">版本历史 Version History</a></li>
<li><a class="reference internal" href="#references">参考文档 References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#terms-and-abbreviations">术语与简写 Terms and Abbreviations</a><ul>
<li><a class="reference internal" href="#terms">术语 Terms</a></li>
<li><a class="reference internal" href="#abbreviations">简写 Abbreviations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#introduction">简介 Introduction</a></li>
<li><a class="reference internal" href="#functional-description">功能描述 Functional Description</a><ul>
<li><a class="reference internal" href="#features">特性 Features</a><ul>
<li><a class="reference internal" href="#message-format">消息格式 Message Format</a></li>
<li><a class="reference internal" href="#time-synchronization-master">时间同步主站 Time Synchronization Master</a></li>
<li><a class="reference internal" href="#time-synchronization-slave">时间同步从站 Time Synchronization Slave</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deviation">偏差 Deviation</a></li>
<li><a class="reference internal" href="#extension">扩展 Extension</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration">集成 Integration</a><ul>
<li><a class="reference internal" href="#file-list">文件列表 File List</a><ul>
<li><a class="reference internal" href="#static-files">静态文件 Static Files</a></li>
<li><a class="reference internal" href="#dynamic-files">动态文件 Dynamic Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling">错误处理 Error Handling</a><ul>
<li><a class="reference internal" href="#development-errors">开发错误 Development Errors</a></li>
<li><a class="reference internal" href="#product-errors">产品错误 Product Errors</a></li>
<li><a class="reference internal" href="#runtime-errors">运行时错误 Runtime Errors</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#interface-description">接口描述 Interface Description</a><ul>
<li><a class="reference internal" href="#type-definitions">类型定义 Type Definitions</a></li>
<li><a class="reference internal" href="#services">提供的服务 Services</a><ul>
<li><a class="reference internal" href="#cantsyn-init">CanTSyn_Init</a></li>
<li><a class="reference internal" href="#cantsyn-getversioninfo">CanTSyn_GetVersionInfo</a></li>
<li><a class="reference internal" href="#cantsyn-settransmissionmode">CanTSyn_SetTransmissionMode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">类型定义 Type Definitions</a></li>
<li><a class="reference internal" href="#id2">提供的服务 Services</a><ul>
<li><a class="reference internal" href="#cantsyn-rxindication">CanTSyn_RxIndication</a></li>
<li><a class="reference internal" href="#cantsyn-txconfirmation">CanTSyn_TxConfirmation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">类型定义 Type Definitions</a></li>
<li><a class="reference internal" href="#configuration-function">配置函数 Configuration function</a><ul>
<li><a class="reference internal" href="#cantsyn-mainfunction">CanTSyn_MainFunction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#applicable-services">依赖的服务 Applicable Services</a><ul>
<li><a class="reference internal" href="#compulsory-interface">强制接口 Compulsory interface</a></li>
<li><a class="reference internal" href="#optional-interface">可选接口 Optional Interface</a></li>
<li><a class="reference internal" href="#configuration-interfaces">配置接口 Configuration Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">配置 Configuration</a></li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
            <div class="text-center">
                    &copy; Copyright 2025, i-soft
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 8.2.3
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="../../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../../_static/doctools.js?v=9bcbadda"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="../../../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../../../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../../../_static/searchtools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("../../../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>