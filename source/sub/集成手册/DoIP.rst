===================
DoIP_é›†æˆæ‰‹å†Œ
===================





ç›®æ ‡
====

æœ¬é›†æˆæ‰‹å†Œç”¨äºæŒ‡å¯¼å®¢æˆ·è¿›è¡ŒDoIPé›†æˆï¼Œæ–‡æ¡£ä¸»è¦åŒ…æ‹¬çš„å†…å®¹ä¸ºï¼šåè®®æ ˆé›†æˆæŒ‡å¯¼ã€åŸºäºæ™®é€šåº”ç”¨çš„é›†æˆç¤ºä¾‹è®²è§£ã€é¡¹ç›®é›†æˆç‰¹æ®Šè¯´æ˜ã€‚

ç”±äºå„é¡¹ç›®çš„éœ€æ±‚ä¸åŒï¼Œé›†æˆç¤ºä¾‹ä¸ä¼šé’ˆå¯¹äºç‰¹å®šçš„å•†ä¸šé¡¹ç›®åšè¯¦ç»†è®²è§£ã€‚

ç¼©å†™è¯å’Œæœ¯è¯­
============

.. table:: è¡¨ 2â€‘1 ç¼©å†™è¯å’Œæœ¯è¯­

   +---------------+------------------------------------------------------+
   |**ç¼©å†™è¯/æœ¯è¯­**| **æè¿°**                                             |
   |               |                                                      |
   +---------------+------------------------------------------------------+
   | DoIP          | Diagnostic over IPåŸºäºIPçš„è¯Šæ–­                       |
   +---------------+------------------------------------------------------+
   | SoAd          | Socket Adapter Socketé€‚é…å™¨                          |
   +---------------+------------------------------------------------------+
   | TcpIp         | Transmission Control Protocol/Internet               |
   |               | Protocolä¼ è¾“æ§åˆ¶åè®®/ç½‘é™…åè®®                        |
   +---------------+------------------------------------------------------+
   | Dcm           | Diagnostic Communication Manager è¯Šæ–­é€šä¿¡ç®¡ç†        |
   +---------------+------------------------------------------------------+
   | Dem           | Diagnostic Event Managerè¯Šæ–­æ—¶é—´ç®¡ç†                 |
   +---------------+------------------------------------------------------+

å‚è€ƒæ–‡æ¡£
========

[1] å‚è€ƒæ‰‹å†Œ_DoIP.pdf

[2] å‚è€ƒæ‰‹å†Œ_TCPIP.pdf

[3] å‚è€ƒæ‰‹å†Œ_DCM.pdf

[4] å‚è€ƒæ‰‹å†Œ_EthIf.pdf

[5] å‚è€ƒæ‰‹å†Œ_SoAd.pdf

[7] UDSonCAN.pdf

åè®®æ ˆé›†æˆ
==========

é¡¹ç›®äº¤ä»˜çš„å†…å®¹ä¸ºï¼šDoIPåè®®æ ˆæºç å’ŒORIENTAIS
Configuratoré…ç½®å·¥å…·ã€‚åè®®æ ˆç»†åˆ†ä¸ºåè®®æ ˆçš„å„æ¨¡å—åŠå…¶å¯¹åº”çš„é…ç½®å·¥å…·æ¨¡å—ã€‚

DoIPåè®®æ ˆå„é…ç½®æ¨¡å—çš„åŠŸèƒ½ä»‹ç»ï¼Œå‚è§è¡¨ 4â€‘1 DoIPåè®®æ ˆå„é…ç½®æ¨¡å—ä»‹ç»ã€‚

ä½¿ç”¨åè®®æ ˆæºç å’Œé…ç½®å·¥å…·ï¼Œè¿›è¡Œåè®®æ ˆçš„é›†æˆçš„æ­¥éª¤ï¼Œå‚è§
è¡¨ 4â€‘2 DoIPåè®®æ ˆé›†æˆçš„æ­¥éª¤ã€‚

.. table:: è¡¨ 4â€‘1 DoIPåè®®æ ˆå„é…ç½®æ¨¡å—ä»‹ç»

   +---------+------------------------------------------------------------+
   | **æ¨¡\   | **åŠŸèƒ½**                                                   |
   | å—å**  |                                                            |
   +---------+------------------------------------------------------------+
   | Eth     | ETHé©±åŠ¨é…ç½®ã€‚                                              |
   +---------+------------------------------------------------------------+
   | EthIf   | EthIfæ¨¡å—ä½¿ç”¨EthIfCtr                                      |
   |         | lIdxæ¥æŠ½è±¡ä»¥å¤ªç½‘æ”¶å‘å™¨å’Œæ§åˆ¶å™¨çš„åº•å±‚é€šä¿¡ç³»ç»Ÿå¯¹VLANçš„è®¿é—®ï¼Œ |
   |         | ä»¥æ­¤ä»¥å¤ªç½‘æ¥å£å®ç°ä»EthCtrlIdxåˆ°å„è‡ªç¡¬ä»¶èµ„æºæ§åˆ¶å™¨çš„æ˜ å°„ã€‚ |
   +---------+------------------------------------------------------------+
   | EcuC    | ç”¨äºè¾…åŠ©é…ç½®å·¥å…·å®Œæˆé…ç½®çš„æ¨¡å—ã€‚ä¸»                         |
   |         | è¦æä¾›Pduçš„å®šä¹‰ï¼Œå…¶å®ƒæ¨¡å—é€šè¿‡å…³è”EcuCä¸­Pduï¼Œç›¸äº’å…³è”èµ·æ¥ã€‚ |
   +---------+------------------------------------------------------------+
   | PduR    | PduRæ¨¡å—ç”¨äºPduåœ¨TPå±‚å’ŒIFå±‚çš„ä¼ è¾“ï¼Œä¸ºCOMå’ŒDCMçš„ä¸‹å±‚        |
   +---------+------------------------------------------------------------+
   | TcpIp   | TcpIpæ¨¡å—ä½œä¸ºä»¥å¤ªç½‘åŸºæœ¬åè®®æ¨¡å—ï¼Œæ                        |
   |         | ä¾›äº†å‘é€å’Œæ¥æ”¶äº’è”ç½‘åè®®æ•°æ®çš„åŠŸèƒ½ï¼Œå¤„äºSoAdå’ŒEthIfä¸­é—´ã€‚  |
   +---------+------------------------------------------------------------+
   | SoAd    | S                                                          |
   |         | oAdæ¨¡å—ä½¿ç”¨PDUå’Œsocketåœ¨TCPIPæ ˆä¹‹é—´åˆ›å»ºæ¥å£ï¼Œå°†Pduä¸socket |
   |         | connection å½¢æˆæ˜ å°„å…³ç³».                                   |
   +---------+------------------------------------------------------------+
   | Dcm     | Dcmæ¨¡å—ä¸ºDoIPæä¾›è¯Šæ–­é€šè®¯ç®¡ç†                              |
   +---------+------------------------------------------------------------+
   | Dem     | Demæ¨¡å—ä¸ºDoIPæä¾›è¯Šæ–­äº‹ä»¶ç®¡ç†                              |
   +---------+------------------------------------------------------------+
   | DoIP    | DoIPå³åŸºäºä»¥å¤ªç½‘çš„è¯Šæ–­ï¼Œ                                   |
   +---------+------------------------------------------------------------+

.. table:: è¡¨ 4â€‘2 DoIPåè®®æ ˆé›†æˆçš„æ­¥éª¤

   +-----+--------------------------+------------------------------------+
   |**æ­¥\| **æ“ä½œ**                 | **è¯´æ˜**                           |
   |éª¤** |                          |                                    |
   |     |                          |                                    |
   |     |                          |                                    |
   +-----+--------------------------+------------------------------------+
   | 1   | ORIENTAIS                | è‹¥é…ç½®å·¥å…·å·²ç»æ­å»º                 |
   |     | Configuratoré…ç½®å·¥å…·     | ï¼Œåˆ™ä»…éœ€è¿›è¡Œåè®®æ ˆæ¨¡å—çš„åŠ è½½æ“ä½œã€‚ |
   |     | å·¥ç¨‹æ­å»ºå’Œåè®®æ ˆæ¨¡å—åŠ è½½ |                                    |
   +-----+--------------------------+------------------------------------+
   | 2   | æ¨¡å—é…ç½®åŠé…ç½®æ–‡ä»¶ç”Ÿæˆ   | NA                                 |
   +-----+--------------------------+------------------------------------+
   | 3   | ä»£ç é›†æˆ                 | ç°æœ‰å·¥ç¨‹ã€                         |
   |     |                          | åè®®æ ˆæºä»£ç å’Œé…ç½®ç”Ÿæˆæ–‡ä»¶çš„é›†æˆã€‚ |
   +-----+--------------------------+------------------------------------+
   | 4   | éªŒè¯æµ‹è¯•                 | NA                                 |
   +-----+--------------------------+------------------------------------+

**æ³¨æ„ï¼šåè®®æ ˆé›†æˆä¹‹å‰ï¼Œç”¨æˆ·é¡»ç¡®ä¿å·²ç»æœ‰åŸºç¡€å·¥ç¨‹ï¼Œä¸”æœ¬åè®®æ ˆç›¸å…³çš„å…¶ä»–åè®®æ ˆèƒ½æ­£å¸¸å·¥ä½œã€‚**

æ–°å»ºORIENTAIS Configuratoré…ç½®å·¥ç¨‹åŠæ¨¡å—åŠ è½½
--------------------------------------------

#. å®‰è£…ORIENTAIS Configuratorè½¯ä»¶åï¼ŒåŒå‡»è½¯ä»¶å›¾æ ‡æ‰“å¼€è½¯ä»¶ã€‚

|image1|

å›¾4-1 æ–°å»ºå·¥ç¨‹-1

2. èœå•æ FileğŸ¡ªNewğŸ¡ªProjectï¼Œæ–°å»ºå·¥ç¨‹ã€‚

|image2|

å›¾4-2 æ–°å»ºå·¥ç¨‹-2

3. åœ¨å¼¹å‡ºçš„æ–°å»ºçª—å£ä¸­é€‰æ‹©Autosarä¸‹çš„ [BSW Project]ï¼Œé€‰æ‹©Nextã€‚

..

|image3|

å›¾4-3 æ–°å»ºå·¥ç¨‹-3

4. åœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥å·¥ç¨‹åï¼Œé€‰æ‹©Finish

|image4|

å›¾4-4 æ–°å»ºå·¥ç¨‹-4

5. é€‰æ‹©[Bsw_Builder]ï¼Œå³é”®å•å‡»ï¼Œé€‰æ‹©New ECU Configurationã€‚

|image5|

å›¾4-5 æ–°å»ºå·¥ç¨‹-5

6. åœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥ECUåï¼Œç„¶åé€‰æ‹©Nextã€‚

|image6|

å›¾4-6 æ–°å»ºå·¥ç¨‹-6

7. é€‰æ‹©[BSW_Builder]->é€‰æ‹©ç›®æ ‡ECU->å³é”®å•æœºé€‰æ‹©[Add Module]ã€‚

|image7|

å›¾ 4â€‘7 æ–°å»ºå·¥ç¨‹-7

8. åœ¨å¼¹å‡ºçš„çª—å£ä¸­å‹¾é€‰éœ€æ·»åŠ çš„æ¨¡å—ï¼Œç‚¹å‡»Finishã€‚

|image8|

å›¾4-8 æ–°å»ºå·¥ç¨‹-8

9. æ–°å»ºå·¥ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸Šä¸€æ­¥æ·»åŠ çš„æ¨¡å—å·²ç»è¢«åŠ å…¥åˆ°å·¥ç¨‹ä¸­ã€‚

|image9|

å›¾4-9 æ–°å»ºå·¥ç¨‹-9

10. MCALé…ç½®å¯¼å…¥ï¼ŒBSWæ¨¡å—éœ€è¦ä¾èµ–MCALç”Ÿæˆçš„Ethæ¨¡å—

    a) ä»MCALé…ç½®å·¥å…·ç”Ÿæˆarxml

..

   |image10|

å›¾4-10 æ–°å»ºå·¥ç¨‹-10

|image11|

å›¾4-11 æ–°å»ºå·¥ç¨‹-11

b) å¯¼å…¥BSWå·¥å…·

..

   |image12|

å›¾4-12 æ–°å»ºå·¥ç¨‹-12

|image13|

å›¾4-13 æ–°å»ºå·¥ç¨‹-13

æ¨¡å—é…ç½®åŠç”Ÿäº§ä»£ç 
------------------

æ¨¡å—é…ç½®
~~~~~~~~

EcuCé…ç½®
~~~~~~~~~~~~~~

|image14|

å›¾4-15 EcuCé…ç½®

æ–°å»ºæºåœ°å€(Source address)å’Œç›®æ ‡åœ°å€(Target
address)çš„æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«é€‰æ‹©SOURCE_ADDRESS_16å’ŒTARGET_ADDRESS_16

|image15|

å›¾4-16 Pdué…ç½®

æ·»åŠ DoIPéœ€è¦çš„Pdu

EthIfé…ç½®
~~~~~~~~~~~~~~

EthIfGeneral


|image16|

å›¾4-17 EthIfé…ç½®-EthIfGeneral

EthIfConfigSet


|image17|

å›¾4-18 EthIfé…ç½®-EthIfConfigSet

|image18|

å›¾4-19 EthIfé…ç½®- EthIfConfigSet

æ·»åŠ ä»¥å¤ªç½‘å¯¹åº”çš„å¸§ç±»å‹ï¼Œé€‰æ‹©å¯¹åº”çš„EthIfOwner,è¿™é‡ŒOwnerä¸ºä¸Šå±‚æ¨¡å—ç¼–å·ï¼Œæ­¤å¤„å¯¹åº”EthRxIndicationConfigsä¸­çš„ä»¥å¤ªç½‘æŠ¥æ–‡æ¥æ”¶å›è°ƒå‡½æ•°ã€‚

Eth_DriverApiConfigSet


|image19|

å›¾4-20 EthIfé…ç½®-Eth_DriverApiConfigSet

å¯¹Ethé©±åŠ¨ä¸­çš„ä»£ç åŸå‹è¿›è¡Œæ˜ å°„ï¼Œéœ€å‚è€ƒMCALæºç è¿›è¡Œä¿®æ”¹ï¼Œä¸€äº›æœªä½¿ç”¨çš„Api(å¦‚TimestampåŠŸèƒ½)éœ€æ”¹ä¸ºNULL_PTRã€‚å¦‚å­˜åœ¨EthTrcvæ¨¡å—ï¼ŒåŒç†åœ¨EthTrcv_DriverApiConfigSetä¸­è¿›è¡Œä¿®æ”¹ã€‚

TcpIpé…ç½®
~~~~~~~~~~~~~~

TcpIpGeneral


ä½¿èƒ½IPv4(æš‚æ—¶åªæ”¯æŒIPv4)

|image20|

å›¾4-21 TcpIpé…ç½®-TcpIpGeneral

ä½¿èƒ½TCPå’ŒUDPï¼Œè®¾ç½®å¯¹åº”çš„æœ€å¤§socketæ•°é‡ã€‚

|image21|

å›¾4-22 TcpIpé…ç½®-TcpIpGeneral

TcpIpConfig


é€‰æ‹©TcpIpIpConfigæ·»åŠ Arpé…ç½®

|image22|

å›¾4-23 TcpIpé…ç½®-TcpIpConfig

TcpIpLocalAddrs æ·»åŠ DoIPä½¿ç”¨çš„IPåœ°å€

|image23|

å›¾4-24 TcpIpé…ç½®-TcpIpConfig

TcpIpSocketOwnerConfigs


æ·»åŠ SoAdæ¨¡å—å¯¹åº”çš„æ¥å£Api

|image24|

å›¾4-25 TcpIpé…ç½®-TcpIpConfig

TcpIpTcpConfig


|image25|

å›¾4-26 TcpIpé…ç½®-TcpIpConfig

TcpIpUdpConfig


|image26|

å›¾4-27 TcpIpé…ç½®-TcpIpConfig

SoAdé…ç½®
~~~~~~~~~~~~~~

SoAdBswModules


|image27|

å›¾4-28 SoAdé…ç½®-SoAdBswModules

å…³è”SoAdç›¸å…³çš„Bswæ¨¡å—

SoAdConfig


é…ç½®DoIPæ‰€éœ€çš„SoAdPduè·¯ç”±

|image28|

å›¾4-29 SoAdé…ç½®-SoAdConfigs

æ·»åŠ SoAdSocketConnectionGroupsï¼Œè®¾ç½®å¯¹åº”çš„æœ¬åœ°portä»¥åŠä¸åŒè¿æ¥çš„è¿œç«¯åœ°å€

|image29|

å›¾4-30 SoAdé…ç½®-SoAdConfigs

|image30|

å›¾4-31 SoAdé…ç½®-SoAdConfigs

åœ¨SoAdPduRoutesä¸­å…³è”é…ç½®çš„SoAdSocketConnectionGroups

|image31|

å›¾4-32 SoAdé…ç½®-SoAdConfigs

æœ€åè®¾ç½®SoAdSocketRoutes

é€‰æ‹©SoAdSocketè·¯ç”±å¯¹åº”çš„SCGroupConnection

|image32|

å›¾4-33 SoAdé…ç½®-SoAdConfigs

é…ç½®å¯¹åº”çš„RouteDest

|image33|

å›¾4-34 SoAdé…ç½®-SoAdConfigs

DoIPé…ç½®
~~~~~~~~

DoIPGeneral


è®¾ç½®DoIPç›¸å…³çš„è®¾ç½®

|image34|

|image35|

å›¾4-35 DoIPé…ç½®-DoIPGenerals

DoIPConfigSet


|image36|

å›¾4-36 DoIPé…ç½®-DoIPConfigSets

è®¾ç½®DoIPçš„äº‹ä»¶idï¼Œç»„idå’Œé€»è¾‘åœ°å€.

|image37|

å›¾4-37 DoIPé…ç½®-DoIPConfigSets

è®¾ç½®DoIPåŠŸèƒ½å¯»å€å’Œç‰©ç†å¯»å€çš„é€šé“ï¼Œé€‰æ‹©é€šé“åœ¨DoIPä¸­çš„Roleï¼Œä»¥åŠå¯¹åº”çš„æºåœ°å€å’Œç›®æ ‡åœ°å€çš„å‚è€ƒç‚¹(åœ¨DoIPConnectionsä¸­è®¾ç½®)ï¼Œä»¥åŠå¯¹åº”çš„æ¥æ”¶å‘é€Pdu.

|image38|

å›¾4-38 DoIPé…ç½®-DoIPConfigSets

æ·»åŠ DoIPConnectionsä¸­çš„DoIPTcp&UdpConnectionsï¼Œå¹¶åˆ†åˆ«é…ç½®å¯¹åº”çš„SoAdæ¥æ”¶Pduå’Œå‘é€Pduï¼Œä»¥åŠUdpè¿æ¥åˆ°SoAdçš„ç»„æ’­(å¹¿æ’­)è¿æ¥Pduã€‚

|image39|

å›¾4-39 DoIPé…ç½®-DoIPConfigSets

åœ¨DoIPConnectionsä¸­è®¾ç½®DoIPçš„ç›®æ ‡åœ°å€ã€‚

|image40|

å›¾4-40 DoIPé…ç½®-DoIPConfigSets

åœ¨DoIPRoutingActivationsä¸­æ·»åŠ DoIPConnectionsä¸­è®¾ç½®çš„DoIPç›®æ ‡åœ°å€å‚è€ƒç‚¹

|image41|

å›¾4-41 DoIPé…ç½®-DoIPConfigSets

æ·»åŠ DoIPçš„è¯Šæ–­ä»ªå¹¶é€‰æ‹©å¯¹åº”çš„æºåœ°å€ï¼Œå‚è€ƒè·¯ç”±æ¿€æ´»æ–¹å¼ã€‚

PduRé…ç½®
~~~~~~~~~~~~~~

PduRBswModules


|image42|

å›¾4-42 PduRé…ç½®-PduRBswModules

æ·»åŠ PduRæœåŠ¡çš„Bswæ¨¡å—ï¼Œé€‰æ‹©å¯¹åº”çš„PduRBswModulesRefåï¼Œå·¥å…·å°†è‡ªåŠ¨å‹¾é€‰æ‰€éœ€Api

PduRoutingTables


|image43|

å›¾4-43 PduRé…ç½®-PduRRoutingTables

PduRçš„è·¯ç”±è¡¨ï¼Œåœ¨DoIPåè®®æ ˆï¼Œéœ€è¦é…ç½®ä»¥ä¸Šè·¯ç”±ï¼Œè·¯ç”±ç±»å‹é€‰æ‹©TPï¼Œé€‰æ‹©è·¯ç”±ä¸­çš„ç›®æ ‡Pdu(PduRDestPdus)å’ŒæºPdu(PduRSrcPdus)ï¼ŒåŒç†æ·»åŠ åŠŸèƒ½å¯»å€è¯·æ±‚è·¯ç”±å’Œå“åº”è·¯ç”±ã€‚

ComMé…ç½®
~~~~~~~~

æ·»åŠ ä¸€è·¯ComMçš„é€šé“ï¼Œåé¢Dcmæ¨¡å—éœ€è¦ç”¨åˆ°è¿™é‡Œ

|image44|

å›¾4-44 ComMé…ç½®-ComMConfigSet

Dcmé…ç½®
~~~~~~~

Dcmæ¨¡å—é…ç½®å¯å‚è€ƒã€ŠUDSonCAN.pdfã€‹ä¸­Dcmçš„é…ç½®ï¼ŒETHçš„è¯Šæ–­é…ç½®åªéœ€ä¿®æ”¹DcmDslæ¨¡å—ï¼š

æ·»åŠ å¯¹åº”çš„ETHæ¨¡å—çš„bufferï¼š

|image45|

å›¾4-45 DCMé…ç½®-DCMConfigSets

æ·»åŠ DcmDslProtocol:

|image46|

å›¾4-46 DCMé…ç½®-DCMConfigSets

Demé…ç½®
~~~~~~~

è¯·å‚è€ƒã€ŠUDSonCAN.pdfã€‹

é…ç½®ä»£ç ç”Ÿæˆ
~~~~~~~~~~~~

#. åœ¨ORIENTAIS
   Configuratorä¸»ç•Œé¢å·¦æ–¹ï¼Œé€‰æ‹©å¯¹åº”çš„åè®®æ ˆï¼Œæˆ–è€…é€‰æ‹©æ•´ä¸ªECUï¼Œå•å‡»å³é”®å¼¹å‡ºValidate
   Allå’ŒGenerate Allèœå•ã€‚

|image47|

å›¾4-47 é…ç½®ä»£ç çš„ç”Ÿæˆ-1

2. é€‰æ‹©Validate
   Allå¯¹æœ¬åè®®æ ˆå„é…ç½®é€‰é¡¹è¿›è¡Œæ ¡éªŒï¼Œæ²¡æœ‰é”™è¯¯æç¤ºä¿¡æ¯å³æ ¡éªŒé€šè¿‡ã€‚è‹¥æœ‰é”™è¯¯ä¿¡æ¯ï¼Œè¯·æŒ‰ç…§é”™è¯¯æç¤ºä¿®æ”¹ã€‚

3. é€‰æ‹©Generate
   Allï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚å³ä¸‹è§’çš„Consoleçª—å£è¾“å‡ºç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ã€‚

|image48|

å›¾4-48 é…ç½®ä»£ç çš„ç”Ÿæˆ-2

4. å°†ORIENTAIS Configuratoråˆ‡æ¢åˆ°Resourceæ¨¡å¼ï¼Œå³å¯æŸ¥çœ‹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚

|image49|

å›¾4-49 é…ç½®ä»£ç çš„ç”Ÿæˆ-3

åŠŸèƒ½é›†æˆ
--------

ä»£ç é›†æˆ
~~~~~~~~

åè®®æ ˆä»£ç åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šé¡¹ç›®æä¾›çš„åè®®æ ˆæºç å’ŒORIENTAIS
Configuratoré…ç½®ç”Ÿæˆä»£ç ã€‚

ç”¨æˆ·é¡»å°†åè®®æ ˆæºç å’Œç« èŠ‚4.2.2ç”Ÿæˆçš„æºä»£ç æ·»åŠ åˆ°é›†æˆå¼€å‘å·¥å…·çš„å¯¹åº”æ–‡ä»¶å¤¹ã€‚åè®®æ ˆé›†æˆçš„æ–‡ä»¶ç»“æ„ï¼Œè§ç« èŠ‚5.2ã€‚

**æ³¨æ„ï¼šåè®®æ ˆé›†æˆä¹‹å‰ï¼Œç”¨æˆ·é¡»ç¡®ä¿å·²ç»æœ‰åŸºç¡€å·¥ç¨‹ï¼Œä¸”æœ¬åè®®æ ˆç›¸å…³çš„å…¶ä»–åè®®æ ˆèƒ½æ­£å¸¸å·¥ä½œã€‚**

é›†æˆæ³¨æ„äº‹é¡¹
~~~~~~~~~~~~

ç”¨æˆ·é¡»æå‰é…ç½®å¥½Ethçš„MCALé©±åŠ¨ï¼Œå¦‚æœä»¥å¤ªç½‘é€šè¿‡ä¸­æ–­å®Œæˆæ¥æ”¶å‘é€ï¼Œåˆ™åœ¨é›†æˆOSä¸­å‰åœ¨OSä¸­é…ç½®å¥½ç›¸å…³çš„ä»¥å¤ªç½‘ä¸­æ–­ã€‚

é›†æˆç¤ºä¾‹
========

æœ¬ç« èŠ‚é€šè¿‡DoIPåè®®æ ˆä¸ºä¾‹ï¼Œå‘ç”¨æˆ·å±•ç¤ºDoIPåè®®æ ˆçš„é›†æˆè¿‡ç¨‹ã€‚ç”¨æˆ·å¯ä»¥æ®æ­¤ç†Ÿæ‚‰DoIPåè®®æ ˆé…ç½®å·¥å…·çš„é…ç½®è¿‡ç¨‹ï¼Œä»¥åŠå¦‚ä½•åº”ç”¨é…ç½®å·¥å…·ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚

ä¸ºè®©ç”¨æˆ·æ›´æ¸…æ™°çš„äº†è§£å·¥å…·çš„ä½¿ç”¨ï¼Œæ‰€ç”¨çš„é…ç½®å‡é€ä¸€æ‰‹åŠ¨å®Œæˆã€‚å…³äºEthé©±åŠ¨çš„é…ç½®ï¼Œè¯·å‚è€ƒEthé…ç½®æ‰‹å†Œã€‚

**æ³¨æ„ï¼šæœ¬ç¤ºä¾‹ä¸ä»£è¡¨ç”¨æˆ·çš„å®é™…é…ç½®æƒ…å†µï¼Œç”¨æˆ·éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚ï¼Œå†³å®šå„ä¸ªå‚æ•°çš„é…ç½®ã€‚**

é›†æˆç›®æ ‡
--------

DoIPé›†æˆå®Œæˆåéœ€æ ¹æ®ä»¥ä¸‹ç¤ºä¾‹æµ‹è¯•ï¼š

DoIPè¯Šæ–­å‚æ•°

è¡¨5-1 DoIPè¯Šæ–­å‚æ•°

+----------------------+-----------------------------------------------+
|**å‚æ•°**              |**å€¼**                                         |
+----------------------+-----------------------------------------------+
| Local IP Address     | 192.168.1.19                                  |
+----------------------+-----------------------------------------------+
| Local Port           | 13400                                         |
+----------------------+-----------------------------------------------+
| Tester SA            | 0x0E88                                        |
+----------------------+-----------------------------------------------+
| ç‰©ç†å¯»å€TA           | 0x0040                                        |
+----------------------+-----------------------------------------------+
| åŠŸèƒ½å¯»å€TA           | 0xE400                                        |
+----------------------+-----------------------------------------------+
| ActiveLine           | ä¸Šç”µå¼€å¯Active                                |
+----------------------+-----------------------------------------------+
| RoutingActiveNumber  | 0                                             |
+----------------------+-----------------------------------------------+
| DoIP Protocol        | 0x02                                          |
| Version              |                                               |
+----------------------+-----------------------------------------------+
| è¯Šæ–­ç¤ºä¾‹DID          | 0xF199ï¼ˆRï¼šAll                                |
|                      | Sessionï¼ŒWï¼š1003Sessionï¼ŒLevel1Securityï¼‰     |
+----------------------+-----------------------------------------------+

DoIPæŠ¥æ–‡ç¤ºä¾‹

è¡¨5-2 DoIPè¯Šæ–­ç¤ºä¾‹æŠ¥æ–‡

+----------------------+-----------------------------------------------+
|**æŠ¥æ–‡ç±»å‹**          |**æŠ¥æ–‡æ ¼å¼**                                   |
+----------------------+-----------------------------------------------+
| è·¯ç”±æ¿€æ´»è¯·æ±‚         | 02 FD 00 05 00 00 00 07 0E 88 00 00 00 00 00  |
+----------------------+-----------------------------------------------+
| ç‰©ç†å¯»å€1003è¯Šæ–­è¯·æ±‚ | 02 FD 80 01 00 00 00 06 0E 88 00 40 10 03     |
+----------------------+-----------------------------------------------+
| åŠŸèƒ½å¯»å€1003è¯Šæ–­è¯·æ±‚ | 02 FD 80 01 00 00 00 06 0E 88 BB BB 10 03     |
+----------------------+-----------------------------------------------+
| è¯·æ±‚Level1 Seed      | 02 FD 80 01 00 00 00 06 0E 88 00 40 27 01     |
+----------------------+-----------------------------------------------+
| å‘é€Level1 Key       | 02 FD 80 01 00 00 00 0A 0E 88 00 40 27 02 11  |
|                      | 22 33 44                                      |
+----------------------+-----------------------------------------------+
| å†™DIDä¿¡æ¯            | 02 FD 80 01 00 00 00 0B 0E 88 00 40 2E F1 99  |
|                      | 01 02 03 04                                   |
+----------------------+-----------------------------------------------+
| è¯»DIDä¿¡æ¯            | 02 FD 80 01 00 00 00 07 0E 88 00 40 22 F1 99  |
+----------------------+-----------------------------------------------+

æºä»£ç é›†æˆ
----------

é¡¹ç›®äº¤ä»˜ç»™ç”¨æˆ·çš„å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š

|image50|

å›¾5-1 å·¥ç¨‹ç»“æ„ç›®å½•

-  ./BSW/Config/BSW_Configç›®å½•ï¼Œè¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ORIENTAIS
   Configuratoré…ç½®å·¥å…·ç”Ÿæˆçš„é…ç½®æ–‡ä»¶

-  ./BSWç›®å½•å­˜æ”¾æ¨¡å—ç›¸å…³çš„æºä»£ç ï¼ˆé™¤./BSW/Configç›®å½•ä¹‹å¤–ï¼‰ã€‚å¯ä»¥çœ‹åˆ°Sourceç›®å½•ä¸‹å„ä¸ªæ–‡ä»¶å¤¹ä¸‹æ˜¯å„ä¸ªæ¨¡å—çš„æºä»£ç ã€‚

åè®®æ ˆè°ƒåº¦é›†æˆ
--------------

DoIPåè®®æ ˆè°ƒåº¦é›†æˆæ­¥éª¤å¦‚ä¸‹ï¼š

#. åè®®æ ˆè°ƒåº¦é›†æˆã€‚

#. ç¼–è¯‘é“¾æ¥ä»£ç ï¼Œå°†ç”Ÿæˆçš„elfæ–‡ä»¶çƒ§å†™è¿›èŠ¯ç‰‡ã€‚

ä»¥ä¸‹ä¸ºç¤ºä¾‹ä»£ç ï¼š

**#include** "Mcu.h"

**#include** "Gpt.h"

**#include** "Eth_17_GEthMac.h"

**#include** "TcpIp.h"

**#include** "ComM.h"

**#include** "SoAd.h"

**#include** "Dem.h"

**#include** "Dcm.h"

**#include** "DoIP.h"

**void** **main** (**void**)

{

Eth_Init(&Eth_Config);

Eth_SetControllerMode(EthConf_EthCtrlConfig_EthCtrlConfig_0,
ETH_MODE_ACTIVE);

/\*\ *Eth*\ å¤–æ¥\ *phy*\ åˆå§‹åŒ–*/

Eth_T_InitPhys();

EthIf_Init(&EthIf_ConfigData);

TcpIp_Init(&TcpIp_Config);

SoAd_Init(&SoAd_Config);

DoIP_Init(&DoIP_PBConfigPtr);

Dem_PreInit();

Dem_Init(&DemPbCfg);

Dcm_Init(&Dcm_Cfg);

**while**\ (1)

{

**if**\ (Gpt_1msFlag == TRUE)

{

/\*DoIPGeneralä¸­é€‰æ‹©DoIPHighFrequencyTaskSupport*/

DoIP_MainFunction_HighFrequency();

Gpt_1msFlag = FALSE;

}

**if**\ (Gpt_5msFlag == TRUE)

{

Gpt_5msFlag = FALSE;

}

**if**\ (Gpt_10msFlag == TRUE)

{

**if**\ ( TCPIP_STATE_ONLINE ==

   TcpIp_GetControlState(TcpIp_Config.CtrlPtr->EthIfCtrlRef ))

{

DoIP_ActivationLineSwitch();

}

Dcm_MainFunction();

Dem_MainFunction();

EcuM_MainFunction();

BswM_MainFunction();

TcpIp_MainFunction();

SoAd_MainFunction();

DoIP_MainFunction();

}

}

}

éªŒè¯ç»“æœ
--------

ç¨‹åºè¿è¡Œåä½¿ç”¨ç½‘ç»œè°ƒè¯•åŠ©æ‰‹å‘é€ä»¥ä¸‹æŒ‡ä»¤éªŒè¯DoIPè¯Šæ–­åŠŸèƒ½ï¼š

|å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ|

å›¾5-2 DoIPæŠ¥æ–‡äº¤äº’ç»“æœç¤ºä¾‹

22è¯» DID

2E å†™DID

å‘é€seed 27 01

å‘é€key 27 02

ç‰©ç†å¯»å€10 03

è·¯ç”±è¯·æ±‚æ¿€æ´»



.. |image1| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image1.png
   :width: 5.60345in
   :height: 3.71875in
.. |image2| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image2.png
   :width: 5.76667in
   :height: 3.82847in
.. |image3| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image3.png
   :width: 5.32292in
   :height: 5.13542in
.. |image4| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image4.png
   :width: 5.35694in
   :height: 4.55208in
.. |image5| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image5.png
   :width: 5.76458in
   :height: 3.82708in
.. |image6| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image6.png
   :width: 5.3125in
   :height: 5.125in
.. |image7| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image7.png
   :width: 5.76042in
   :height: 3.83125in
.. |image8| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image8.png
   :width: 3.55486in
   :height: 6.16597in
.. |image9| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image9.png
   :width: 3.84375in
   :height: 4.62292in
.. |image10| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image10.png
   :width: 4.75486in
   :height: 2.975in
.. |image11| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image11.png
   :width: 5.76319in
   :height: 4.34722in
.. |image12| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image12.png
   :width: 4.13056in
   :height: 3.27222in
.. |image13| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image13.png
   :width: 5.66667in
   :height: 5.11458in
.. |image14| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image14.png
   :width: 5.76042in
   :height: 1.98889in
.. |image15| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image15.png
   :width: 5.76458in
   :height: 3.03819in
.. |image16| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image16.png
   :width: 3.71574in
   :height: 4.74458in
.. |image17| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image17.png
   :width: 5.75694in
   :height: 2.56319in
.. |image18| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image18.png
   :width: 5.75903in
   :height: 2.49444in
.. |image19| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image19.png
   :width: 5.76111in
   :height: 2.925in
.. |image20| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image20.png
   :width: 5.75556in
   :height: 2.52292in
.. |image21| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image21.png
   :width: 5.7625in
   :height: 2.26181in
.. |image22| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image22.png
   :width: 5.75556in
   :height: 3.75486in
.. |image23| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image23.png
   :width: 5.75903in
   :height: 2.83403in
.. |image24| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image24.png
   :width: 5.76111in
   :height: 3.20417in
.. |image25| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image25.png
   :width: 5.76736in
   :height: 3.50556in
.. |image26| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image26.png
   :width: 5.76667in
   :height: 3.55in
.. |image27| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image27.png
   :width: 5.75556in
   :height: 2.34375in
.. |image28| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image28.png
   :width: 5.76597in
   :height: 2.75208in
.. |image29| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image29.png
   :width: 5.76111in
   :height: 2.99653in
.. |image30| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image30.png
   :width: 5.76667in
   :height: 2.57917in
.. |image31| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image31.png
   :width: 5.76528in
   :height: 2.68056in
.. |image32| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image32.png
   :width: 5.76597in
   :height: 2.40486in
.. |image33| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image33.png
   :width: 5.76458in
   :height: 2.41736in
.. |image34| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image34.png
   :width: 5.76389in
   :height: 2.99306in
.. |image35| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image35.png
   :width: 5.75417in
   :height: 3.22986in
.. |image36| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image36.png
   :width: 5.76181in
   :height: 2.07153in
.. |image37| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image37.png
   :width: 5.76528in
   :height: 2.14653in
.. |image38| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image38.png
   :width: 5.62205in
   :height: 2.6853in
.. |image39| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image39.png
   :width: 5.50041in
   :height: 2.64898in
.. |image40| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image40.png
   :width: 5.4958in
   :height: 2.41481in
.. |image41| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image41.png
   :width: 5.45976in
   :height: 1.99768in
.. |image42| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image42.png
   :width: 5.75972in
   :height: 3.46667in
.. |image43| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image43.png
   :width: 5.75694in
   :height: 2.32708in
.. |image44| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image44.png
   :width: 5.76458in
   :height: 2.77778in
.. |image45| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image45.png
   :width: 5.76667in
   :height: 2.38611in
.. |image46| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image46.png
   :width: 5.75625in
   :height: 2.87361in
.. |image47| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image47.png
   :width: 3.68657in
   :height: 3.76841in
.. |image48| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image48.png
   :width: 5.76319in
   :height: 1.75139in
.. |image49| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image49.png
   :width: 5.75972in
   :height: 2.22917in
.. |image50| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image50.png
   :width: 1.98472in
   :height: 3.65625in
.. |å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ| image:: ../../_static/é›†æˆæ‰‹å†Œ/DoIP/image51.png
   :width: 5.76736in
   :height: 5.17361in
