===================
EthTSyn_é›†æˆæ‰‹å†Œ
===================





ç›®æ ‡
====

æœ¬é›†æˆæ‰‹å†Œç”¨äºæŒ‡å¯¼å®¢æˆ·è¿›è¡Œä»¥å¤ªç½‘æ—¶é—´åŒæ­¥é›†æˆï¼Œæ–‡æ¡£ä¸»è¦åŒ…æ‹¬çš„å†…å®¹ä¸ºï¼šåè®®æ ˆé›†æˆæŒ‡å¯¼ã€åŸºäºæ™®é€šåº”ç”¨çš„é›†æˆç¤ºä¾‹è®²è§£ã€é¡¹ç›®é›†æˆç‰¹æ®Šè¯´æ˜ã€‚

ç”±äºå„é¡¹ç›®çš„éœ€æ±‚ä¸åŒï¼Œé›†æˆç¤ºä¾‹ä¸ä¼šé’ˆå¯¹äºç‰¹å®šçš„å•†ä¸šé¡¹ç›®åšè¯¦ç»†è®²è§£ã€‚

ç¼©å†™è¯å’Œæœ¯è¯­
============

.. table:: è¡¨ 2-1 ç¼©å†™è¯å’Œæœ¯è¯­

   +---------------+------------------------------------------------------+
   | **\           | **æè¿°**                                             |
   | ç¼©å†™è¯/æœ¯è¯­** |                                                      |
   +---------------+------------------------------------------------------+
   | EthIf         | Eth é€šä¿¡çš„æ¥å£æ¨¡å—                                   |
   +---------------+------------------------------------------------------+
   | EthTSyn       | TimeSyncOverEthernet åŸºäºä»¥å¤ªç½‘çš„æ—¶é—´åŒæ­¥            |
   +---------------+------------------------------------------------------+
   | StbM          | SynchronizedTimeBaseManager åŒæ­¥æ—¶é—´åŸºç®¡ç†           |
   +---------------+------------------------------------------------------+

å‚è€ƒæ–‡æ¡£
========

[1] å‚è€ƒæ‰‹å†Œ_EthTSyn.pdf

[2] å‚è€ƒæ‰‹å†Œ_StbM.pdf

[3] å‚è€ƒæ‰‹å†Œ_EthIf.pdf

åè®®æ ˆé›†æˆ
==========

é¡¹ç›®äº¤ä»˜çš„å†…å®¹ä¸ºï¼šä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆæºç å’ŒORIENTAIS
Configuratoré…ç½®å·¥å…·ã€‚åè®®æ ˆç»†åˆ†ä¸ºåè®®æ ˆçš„å„æ¨¡å—åŠå…¶å¯¹åº”çš„é…ç½®å·¥å…·æ¨¡å—ã€‚

ä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆå„é…ç½®æ¨¡å—çš„åŠŸèƒ½ä»‹ç»ã€‚

ä½¿ç”¨åè®®æ ˆæºç å’Œé…ç½®å·¥å…·ï¼Œè¿›è¡Œåè®®æ ˆçš„é›†æˆçš„æ­¥éª¤ã€‚

.. table:: è¡¨ 4-1 ä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆå„é…ç½®æ¨¡å—ä»‹ç»

   +---------+------------------------------------------------------------+
   | **æ¨¡\   | **åŠŸèƒ½**                                                   |
   | å—å**  |                                                            |
   +---------+------------------------------------------------------------+
   | Eth     | Ethé©±åŠ¨é…ç½®ã€‚                                              |
   +---------+------------------------------------------------------------+
   | EthIf   | EthIfæ¨¡å—ä¸»è¦å¤„ç†ä¸Šå±‚æ¨¡å—ä¸åº•å±‚é©±åŠ¨çš„ä¹‹é—´                  |
   |         | PDUçš„ä¼ é€’ï¼Œä¸ºä¸Šå±‚æ¨¡å—æä¾›ç»Ÿä¸€çš„æ¥å£æ¥ç®¡ç†ä¸åŒçš„Ethç¡¬ä»¶æ¨¡å— |
   +---------+------------------------------------------------------------+
   | EthTSyn | EthTSynæ¨¡å—å¤„ç†ä»¥å¤ªç½‘ä¸Šçš„æ—¶é—´åŒæ­¥åè®®                      |
   +---------+------------------------------------------------------------+
   | StbM    | åŒæ­¥æ—¶é—´åŸºç¡€ç®¡ç†å™¨çš„ç›®çš„æ˜¯æä¾›                             |
   |         | åŒæ­¥ç»™å®¢æˆ·çš„æ—¶é—´åŸºæ•°ï¼Œä¸é“¾è·¯ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸Šçš„æ—¶é—´åŸºæ•°åŒæ­¥ã€‚ |
   +---------+------------------------------------------------------------+

.. table:: è¡¨ 4-2 ä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆé›†æˆçš„æ­¥éª¤

   +-----+--------------------------+------------------------------------+
   |**æ­¥\| **æ“ä½œ**                 | **è¯´æ˜**                           |
   |éª¤** |                          |                                    |
   |     |                          |                                    |
   |     |                          |                                    |
   +-----+--------------------------+------------------------------------+
   | 1   | ORIENTAIS                | è‹¥é…ç½®å·¥å…·å·²ç»æ­å»º                 |
   |     | Configuratoré…ç½®å·¥å…·     | ï¼Œåˆ™ä»…éœ€è¿›è¡Œåè®®æ ˆæ¨¡å—çš„åŠ è½½æ“ä½œã€‚ |
   |     | å·¥ç¨‹æ­å»ºå’Œåè®®æ ˆæ¨¡å—åŠ è½½ |                                    |
   +-----+--------------------------+------------------------------------+
   | 2   | æ¨¡å—é…ç½®åŠé…ç½®æ–‡ä»¶ç”Ÿæˆ   | NA                                 |
   +-----+--------------------------+------------------------------------+
   | 3   | ä»£ç é›†æˆ                 | ç°æœ‰å·¥ç¨‹ã€                         |
   |     |                          | åè®®æ ˆæºä»£ç å’Œé…ç½®ç”Ÿæˆæ–‡ä»¶çš„é›†æˆã€‚ |
   +-----+--------------------------+------------------------------------+
   | 4   | éªŒè¯æµ‹è¯•                 | NA                                 |
   +-----+--------------------------+------------------------------------+

**æ³¨æ„ï¼šåè®®æ ˆé›†æˆä¹‹å‰ï¼Œç”¨æˆ·é¡»ç¡®ä¿å·²ç»æœ‰åŸºç¡€å·¥ç¨‹ï¼Œä¸”æœ¬åè®®æ ˆç›¸å…³çš„å…¶ä»–åè®®æ ˆèƒ½æ­£å¸¸å·¥ä½œã€‚**

æ–°å»ºORIENTAIS Configuratoré…ç½®å·¥ç¨‹åŠæ¨¡å—åŠ è½½
--------------------------------------------

#. å®‰è£…ORIENTAIS Configuratorè½¯ä»¶åï¼ŒåŒå‡»è½¯ä»¶å›¾æ ‡æ‰“å¼€è½¯ä»¶ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image1.png
   :width: 5.76389in
   :height: 3.06042in

å›¾ 4-1 æ–°å»ºå·¥ç¨‹-1

2. èœå•æ FileğŸ¡ªNewğŸ¡ªProjectï¼Œæ–°å»ºå·¥ç¨‹ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image2.png
   :width: 5.75625in
   :height: 3.17292in

å›¾ 4-2 æ–°å»ºå·¥ç¨‹-2

3. åœ¨å¼¹å‡ºçš„æ–°å»ºçª—å£ä¸­é€‰æ‹©Autosarä¸‹çš„ [BSW Project]ï¼Œé€‰æ‹©Nextã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image3.png
   :width: 5.75625in
   :height: 3.17292in

å›¾ 4-3 æ–°å»ºå·¥ç¨‹-3

4. åœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥å·¥ç¨‹åï¼Œé€‰æ‹©Finishã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image4.png
   :width: 5.75625in
   :height: 3.17292in

å›¾ 4-4 æ–°å»ºå·¥ç¨‹-4

5. åœ¨å¼¹å‡ºçš„çª—å£ä¸­é€‰æ‹©Yesã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image5.png
   :width: 4.06777in
   :height: 1.90141in

å›¾ 4-5 æ–°å»ºå·¥ç¨‹-5

6. é€‰æ‹©[Bsw_Builder]ï¼Œå³é”®å•å‡»ï¼Œé€‰æ‹©New ECU Configurationã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image6.png
   :width: 4.29931in
   :height: 1.97778in

å›¾ 4-6 æ–°å»ºå·¥ç¨‹-6

7. åœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥ECUåï¼Œç„¶åé€‰æ‹©Nextã€‚

æ­¤å¤„ä»¥TC397ä¸ºä¾‹ï¼Œç”¨æˆ·æ ¹æ®é¡¹ç›®èŠ¯ç‰‡è¿›è¡Œé€‰æ‹©ã€‚

|image1|

å›¾ 4-7 æ–°å»ºå·¥ç¨‹-7

8. åœ¨å¼¹å‡ºçš„çª—å£ä¸­å‹¾é€‰éœ€æ·»åŠ çš„æ¨¡å—ï¼Œç‚¹å‡»Finishã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image8.png
   :width: 3.20076in
   :height: 4.48569in

å›¾ 4-8 æ–°å»ºå·¥ç¨‹-8

9. æ–°å»ºå·¥ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸Šä¸€æ­¥æ·»åŠ çš„æ¨¡å—å·²ç»è¢«åŠ å…¥åˆ°å·¥ç¨‹ä¸­ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image9.png
   :width: 1.70812in
   :height: 1.0832in

å›¾ 4-9 æ–°å»ºå·¥ç¨‹-9

æ¨¡å—é…ç½®åŠä»£ç ç”Ÿæˆ
------------------

æ¨¡å—é…ç½®
~~~~~~~~

æ¨¡å—çš„å…·ä½“é…ç½®ï¼Œå–å†³äºå…·ä½“çš„é¡¹ç›®éœ€æ±‚ã€‚è¯¥åè®®æ ˆå„æ¨¡å—é…ç½®é¡¹çš„è¯¦ç»†ä»‹ç»ï¼Œå‚è§è¡¨4-3ã€‚

.. table:: è¡¨ 4-3 åè®®æ ˆå„æ¨¡å—é…ç½®å‚è€ƒæ–‡æ¡£

   +--------+----------------------------------------+-------------------+
   | **\    | **å‚è€ƒæ–‡æ¡£**                           | **è¯´æ˜**          |
   | æ¨¡å—** |                                        |                   |
   +--------+----------------------------------------+-------------------+
   | Eth    | MCALå¯¹åº”çš„Ethé…ç½®æ‰‹å†Œ                  |                   |
   +--------+----------------------------------------+-------------------+
   | EthIf  | å‚è€ƒæ‰‹å†Œ_EthIf.pdf                     |                   |
   +--------+----------------------------------------+-------------------+

é…ç½®ä»£ç ç”Ÿæˆ
~~~~~~~~~~~~

#. åœ¨ORIENTAIS
   Configuratorä¸»ç•Œé¢å·¦æ–¹ï¼Œé€‰æ‹©å¯¹åº”çš„åè®®æ ˆï¼Œå•å‡»å³é”®å¼¹å‡ºValidate
   Allå’ŒGenerate Allèœå•ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image10.png
   :width: 5.76667in
   :height: 4.05139in

å›¾ 4-10 é…ç½®ä»£ç çš„ç”Ÿæˆ-1

2. é€‰æ‹©Validate
   Allå¯¹æœ¬åè®®æ ˆå„é…ç½®é€‰é¡¹è¿›è¡Œæ ¡éªŒï¼Œæ²¡æœ‰é”™è¯¯æç¤ºä¿¡æ¯å³æ ¡éªŒé€šè¿‡ã€‚è‹¥æœ‰é”™è¯¯ä¿¡æ¯ï¼Œè¯·æŒ‰ç…§é”™è¯¯æç¤ºä¿®æ”¹ã€‚

3. é€‰æ‹©Generate
   Allï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚å³ä¸‹è§’çš„Consoleçª—å£è¾“å‡ºç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image11.png
   :width: 5.76736in
   :height: 2.24792in

å›¾ 4-11 é…ç½®ä»£ç çš„ç”Ÿæˆ-2

4. å°†ORIENTAIS Configuratoråˆ‡æ¢åˆ°Resourceæ¨¡å¼ï¼Œå³å¯æŸ¥çœ‹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image12.png
   :width: 5.76736in
   :height: 3.88403in

å›¾ 4-12 é…ç½®ä»£ç çš„ç”Ÿæˆ-3

åŠŸèƒ½é›†æˆ
--------

ä»£ç é›†æˆ
~~~~~~~~

åè®®æ ˆä»£ç åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šé¡¹ç›®æä¾›çš„åè®®æ ˆæºç å’ŒORIENTAIS
Configuratoré…ç½®ç”Ÿæˆä»£ç ã€‚

ç”¨æˆ·é¡»å°†åè®®æ ˆæºç å’Œç« èŠ‚4.2.2ç”Ÿæˆçš„æºä»£ç æ·»åŠ åˆ°é›†æˆå¼€å‘å·¥å…·çš„å¯¹åº”æ–‡ä»¶å¤¹ã€‚åè®®æ ˆé›†æˆçš„æ–‡ä»¶ç»“æ„ï¼Œè§ç« èŠ‚5.3ã€‚

**æ³¨æ„ï¼šåè®®æ ˆé›†æˆä¹‹å‰ï¼Œç”¨æˆ·é¡»ç¡®ä¿å·²ç»æœ‰åŸºç¡€å·¥ç¨‹ï¼Œä¸”æœ¬åè®®æ ˆç›¸å…³çš„å…¶ä»–åè®®æ ˆèƒ½æ­£å¸¸å·¥ä½œã€‚**

é›†æˆç¤ºä¾‹
========

æœ¬ç« èŠ‚é€šè¿‡ä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆä¸ºä¾‹ï¼Œå‘ç”¨æˆ·å±•ç¤ºä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆçš„é›†æˆè¿‡ç¨‹ã€‚ç”¨æˆ·å¯ä»¥æ®æ­¤ç†Ÿæ‚‰ä»¥å¤ªç½‘æ—¶é—´åŒæ­¥åè®®æ ˆé…ç½®å·¥å…·çš„é…ç½®è¿‡ç¨‹ï¼Œä»¥åŠå¦‚ä½•åº”ç”¨é…ç½®å·¥å…·ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ã€‚

ä¸ºè®©ç”¨æˆ·æ›´æ¸…æ™°çš„äº†è§£å·¥å…·çš„ä½¿ç”¨ï¼Œæ‰€ç”¨çš„é…ç½®å‡é€ä¸€æ‰‹åŠ¨å®Œæˆï¼ŒEthiféƒ¨åˆ†é…ç½®é›†æˆè¯·å‚è€ƒã€Šå‚è€ƒæ‰‹å†Œ_EthIf.pdfã€‹ã€‚

**æ³¨æ„ï¼šæœ¬ç¤ºä¾‹ä¸ä»£è¡¨ç”¨æˆ·çš„å®é™…é…ç½®æƒ…å†µï¼Œç”¨æˆ·éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚ï¼Œå†³å®šå„ä¸ªå‚æ•°çš„é…ç½®ã€‚**

é›†æˆç›®æ ‡
--------

å®¢æˆ·èƒ½é€šè¿‡ç¬¬ä¸‰æ–¹åŒæ­¥å·¥å…·ï¼ˆCanoeï¼‰å¯¹æ±½è½¦ç”µå­ç”µæ§å•å…ƒè¿›è¡ŒåŒæ­¥åŠŸèƒ½å®ç°ï¼Œä¸ºå…¶æä¾›è¯»å‡ºåŒæ­¥æ•°æ®ã€åŒæ­¥å·®å€¼è¯»å–åŠç›¸å…³é€šä¿¡æœåŠ¡çš„è½¯ä»¶æ¨¡å—ã€‚

æ¨¡å—çš„é…ç½®
----------

æ–°å»ºé…ç½®å·¥ç¨‹åŠæ¨¡å—åŠ è½½æ“ä½œï¼Œè¯·å‚è€ƒæœ¬æ–‡æ¡£4.2ç« èŠ‚ã€‚

StbMæ¨¡å—é…ç½®
~~~~~~~~~~~~

#. åŒå‡»StbMæ¨¡å—ï¼Œæ‰“å¼€StbMæ¨¡å—çš„é…ç½®ç•Œé¢ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image13.png
   :width: 5.75625in
   :height: 3.17292in

å›¾ 5-1 StbMGeneralé…ç½®ç•Œé¢

2. åœ¨StbMGeneralä¸‹ï¼Œæ¯ä¸ªé€‰é¡¹å…·ä½“æ³¨é‡Šæ„æ€å¯åœ¨å³ä¸‹è§’æŸ¥æ‰¾ã€‚

3. åœ¨StbMSynchronizedTimeBaseç•Œé¢,å³é”®æ–°å»ºä¸¤ä¸ªæ—¶é—´åŸºï¼Œä¸€ä¸ªä¸ºä¸»ï¼Œä¸€ä¸ªä¸ºä»ä¸¤ç§æ¨¡å¼é…ç½®ä¸€è‡´ï¼Œæ­¤å¤„éœ€è¦æ³¨æ„StbMLocalTimeClockå®¹å™¨ä¸­StbMClockFrequencyä¸ºç¡¬ä»¶å¼•ç”¨GPTçš„ä¸»é¢‘æ—¶é—´ï¼ŒStbMLocalTimeHardwareä¸ºå¼•ç”¨MCALé…ç½®çš„GPTæ¨¡å—ï¼›è‹¥ç”¨Ethç¡¬ä»¶æ—¶é’Ÿï¼Œåˆ™ä¸å‹¾é€‰ã€‚

..

   å…¶ä»–é…ç½®é¡¹å®¢æˆ·å¯æŒ‰OEMéœ€æ±‚é…ç½®ï¼Œæ­¤å¤„é…ç½®åªæ˜¯ç®€å•Demoé…ç½®ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image14.png
   :width: 5.75625in
   :height: 3.17292in

å›¾ 5-2 StbMSynchronizedTimeBaseé…ç½®ç•Œé¢-1

4. StbMSynchronizedTimeBases->StbMSynchronizedTimeBase->StbMLocalTimeClocks->StbMLocalTimeClockçš„é…ç½®ï¼š

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image15.png
   :width: 5.75625in
   :height: 2.17292in

å›¾ 5-3 StbMSynchronizedTimeBaseé…ç½®ç•Œé¢-2

   StbMClockFrequencyä¸­å¡«å†™StbMæ‰€å¼•ç”¨çš„Gptå®šæ—¶å™¨çš„æ—¶é’Ÿé¢‘ç‡ã€‚è‹¥æ˜¯Ethæ—¶é’Ÿåˆ™é»˜è®¤1000000000ã€‚

   StbMLocalTimeHardwareå¼•ç”¨æ‰€éœ€è¦å¼•ç”¨çš„Gptçš„å®šæ—¶å™¨é€šé“ã€‚è‹¥æ˜¯Ethæ—¶é’Ÿåˆ™é»˜è®¤1ã€‚

5. StbMSynchronizedTimeBases->StbMSynchronizedTimeBase->StbMLocalTimeClocks->StbMTimeCorrectionçš„é…ç½®ï¼š

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image16.png
   :width: 5.24167in
   :height: 2.47778in

å›¾ 5-4 StbMLocalTimeCorrectioné…ç½®ç•Œé¢

StbMAllowMasterRateCorrectionå¦‚æœä¸»èŠ‚ç‚¹å¯ç”¨correctionåŠŸèƒ½åˆ™éœ€è¦å¼€å¯ã€‚

StbMMasterRateDeviationMaxå¡«å†™ç”±
StbM_SetRateCorrectionï¼ˆï¼‰è®¾ç½®çš„é€Ÿç‡åå·®å€¼çš„æœ€å¤§å…è®¸ç»å¯¹å€¼ã€‚

StbMOffsetCorrectionAdaptionIntervalå¡«å†™é€‚åº”æ€§çš„é€Ÿç‡çŸ«æ­£è¶³ä»¥æ¶ˆé™¤é€Ÿç‡å’Œæ—¶é—´åå·®å€¼çš„æ—¶é—´åŒºé—´ã€‚

StbMOffsetCorrectionJumpThresholdç”¨äºå†³å®šä½¿ç”¨ä»€ä¹ˆæ ·çš„çŸ«æ­£æ–¹å¼ã€‚åå·®å€¼è‹¥å°äºæ­¤å€¼ï¼Œåˆ™åœ¨å®šä¹‰çš„æ—¶é—´å‘¨æœŸå†…ä½¿ç”¨çº¿æ€§ç¼©å‡ï¼ˆlinear
reductionï¼‰çŸ«æ­£ã€‚è‹¥å¤§äºæ­¤å€¼ï¼Œåˆ™ä»¥è·³è·ƒçš„æ–¹å¼ç«‹å³è®¾ç½®æ­£ç¡®çš„æ—¶é—´å’Œé€Ÿç‡ã€‚

StbMRateCorrectionMeasurementDurationå¡«å†™ç”¨äºè®¡ç®—é€Ÿç‡å·®çš„æ—¶é—´åŒºé—´ã€‚

StbMRateCorrectionsPerMeasurementDurationå¡«å†™åŒæ—¶è¿›è¡Œé€Ÿç‡æµ‹é‡çš„æ¬¡æ•°ï¼Œä»¥ç¡®å®šå½“å‰é€Ÿç‡åå·®ã€‚

EthTSynæ¨¡å—é…ç½®
~~~~~~~~~~~~~~~

#. åŒå‡»EthTSynæ¨¡å—ï¼Œæ‰“å¼€EthTSynæ¨¡å—çš„é…ç½®ç•Œé¢ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image17.png
   :width: 5.76736in
   :height: 3.19097in

å›¾ 5-5 EthTSynGeneralé…ç½®ç•Œé¢

2. åœ¨EthTSynGeneralä¸‹ï¼Œæ¯ä¸ªé€‰é¡¹å…·ä½“æ³¨é‡Šæ„æ€å¯åœ¨å³ä¸‹è§’æŸ¥æ‰¾ã€‚æ­¤å®¹å™¨ä¸‹éœ€è¦æ³¨æ„EthTSynDestPhyAddrï¼Œæ­¤å®¹å™¨å»ºç«‹æ—¶ç›®æ ‡çš„MACåœ°å€ä¼šé»˜è®¤ä¸º01:80:C2:00:00:0Eï¼ˆæ­¤åœ°å€ä¸ºå¤šæ’­åœ°å€ï¼Œæ”¯æŒå¤šMACä¸»èŠ‚ç‚¹æˆæ—¶ï¼‰ï¼Œæ­¤å¤„éœ€è¦å®¢æˆ·æŒ‰æ•´è½¦åˆ†é…åœ°å€é‡æ–°å¡«å†™ã€‚

3. åœ¨EthTSynGlobalTimeDomainä¸‹ï¼Œå³é”®æ–°å»ºä¸¤ä¸ªä»¥å¤ªç½‘æ—¶é—´åŸŸï¼Œä¸€ä¸»ä¸€ä»ã€‚

..

   DomainIdé…ç½®å¯ä¸º0~31ï¼ŒEthTSynSynchronizedTimeBaseRefæ­¤å¤„å¼•ç”¨StbMæ¨¡å—ä¸­é…ç½®çš„ä¸»æˆ–è€…ä»ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image18.png
   :width: 5.76111in
   :height: 2.24375in

å›¾ 5-6 EthTSynGlobalTimeDomainé…ç½®ç•Œé¢

4. åœ¨EthTSynGlobalTimeSlaveä¸‹ï¼ŒEthTSynRxCrcValidatedé€‰æ‹©æ— CRCæ ¡éªŒæ¨¡å¼ï¼ŒEthTSynGlobalTimeFollowUpTimeouté…ç½®ä¸º300msã€‚EthTSynGlobalTimeSequenceCounterJumpWidthè®¾ç½®ä¸º1ï¼Œå°†æ£€æŸ¥ä¸¤ä¸ªè¿ç»­åŒæ­¥ä¹‹é—´çš„
   SC
   å€¼è·³è½¬ã€‚EthTSynGlobalTimeSequenceCounterHysteresisè‹¥å‘ç”Ÿè¶…æ—¶ï¼Œåœ¨è½¬å‘æœ‰æ•ˆæ—¶é—´ä¹‹å‰ï¼Œè‡³å°‘è¦éªŒè¯çš„Sync-Follow
   Upæ¶ˆæ¯å¯¹ä¸ªæ•°ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image19.png
   :width: 5.75208in
   :height: 2.25625in

å›¾ 5-7 EthTSynGlobalTimeSlaveé…ç½®ç•Œé¢

5. åœ¨EthTSynGlobalTimeMasterä¸‹ï¼ŒEthTSynRxCrcValidatedé€‰æ‹©æ— CRCæ ¡éªŒæ¨¡å¼ï¼ŒEthTSynCyclicMsgResumeTimeé…ç½®ä¸º500msï¼ŒEthTSynGlobalTimeTxPeriodé…ç½®ä¸º1sï¼ŒEthTSynImmediateTimeSyncé€‰æ‹©ä¸ºTRUEã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image20.png
   :width: 5.75208in
   :height: 2.25625in

å›¾ 5-8 EthTSynGlobalTimeMasteré…ç½®ç•Œé¢

6. åœ¨EthTSynPortConfigä¸‹ï¼Œ
   EthTSynGlobalTimeDebounceTimeé…ç½®ä¸º10msï¼ŒEthTSynGlobalTimeEthIfRefæ­¤å¤„å¼•ç”¨Ethifé…ç½®çš„Ethé©±åŠ¨æ¨¡å—ã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image21.png
   :width: 5.76458in
   :height: 2.86944in

å›¾ 5-9 EthTSynPortConfigé…ç½®ç•Œé¢

æºä»£ç é›†æˆ
----------

é¡¹ç›®äº¤ä»˜ç»™ç”¨æˆ·çš„å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image22.png
   :width: 3.25069in
   :height: 2.90069in

å›¾ 5-10 å·¥ç¨‹ç»“æ„ç›®å½•

-  Bsw_Configç›®å½•ï¼Œè¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾é…ç½®å·¥å…·ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼ŒEthIfã€StbMã€EthTSynæœ‰å…³çš„é…ç½®æ–‡ä»¶æ”¾åœ¨Bsw_Configæ–‡ä»¶å¤¹ä¸‹ã€‚

-  BSWç›®å½•ï¼Œå­˜æ”¾BSWç›¸å…³æ¨¡å—çš„æºä»£ç .

åè®®æ ˆè°ƒåº¦é›†æˆ
--------------

**#include** <machine/wdtcon.h>

**#include** "Mcu.h"

**#include** "Port.h"

**#include** "Eth_17_GEthMac.h"

**#include** "EthIf.h"

**#include** "Gpt.h"

**#include "**\ StbM.h\ **"**

**#include "**\ EthTSyn.h"

**int** **main**\ (**void**)

{

Gpt_EnableNotification(GptConf_GptChannel_Gpt_1ms);

Gpt_StartTimer(GptConf_GptChannel_Gpt_1ms, 100000);

Gpt_StartTimer(GptChannelConfiguration_STBM, 0xFFFFFFu);

StbM_Init(&StbM_Config);

Eth_17_GEthMac_Init(&Eth_17_GEthMac_Config);

EthIf_Init(&EthIf_ConfigData);

EthTSyn_Init(&EthTSyn_Config);

EthTSyn_SetTransmissionMode(0,ETHTSYN_TX_ON);


StbM_TimeStampType test1 = {0u};

StbM_UserDataType test2 = {0u};

test1.secondsHi = 0;

test1.seconds = 1696903810;

test1.nanoseconds = 0;

StbM_SetGlobalTime(0,&test1,&test2);

**while** (1)

{

   **if**\ (:mark:`Gpt_1msFlag` == TRUE)

{

Gpt_1msFlag = FALSE;

}

**if**\ (Gpt_10msFlag == TRUE)

{

/\* please insert your code here ... \*/

EthTSyn_MainFunction();

   StbM_MainFunction();

   StbM_GetCurrentTime(0, &timestamp,&userData\ **);**

   PduInfo.sdu[0] =

   (uint8)((StbM_TimeStamp.seconds & 0xff000000) >> 24);

   PduInfo.sdu[1] =

   (uint8)((StbM_TimeStamp.seconds & 0x00ff0000) >> 16);

   PduInfo.sdu[2] =

   (uint8)((StbM_TimeStamp.seconds & 0x0000ff00) >> 8);

   PduInfo.sdu[3] =

   (uint8)((StbM_TimeStamp.seconds & 0x000000ff));

   PduInfo.sdu[4] =

   (uint8)((StbM_TimeStamp.nanoseconds & 0xff000000) >> 24);

   PduInfo.sdu[5] =

   (uint8)((StbM_TimeStamp.nanoseconds & 0x00ff0000) >> 16);

   PduInfo.sdu[6] =

   (uint8)((StbM_TimeStamp.nanoseconds & 0x0000ff00) >> 8);

   PduInfo.sdu[7] =

   (uint8)((StbM_TimeStamp.nanoseconds & 0x000000ff));

Can_Write(2, &PduInfo);

}

}

**return** 1;

}

éªŒè¯ç»“æœ
--------

æ ¹æ®é›†æˆç›®æ ‡ï¼Œèƒ½å¤Ÿè·ŸCANoeæ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸‹æ˜¯éªŒè¯æ•ˆæœï¼Œå³ä¾§ä¸ºä»¥å¤ªç½‘æŠ¥æ–‡ï¼Œå·¦ä¾§ä¸ºCANè½¬å‘çš„StbMæ¨¡å—åŒæ­¥æ—¶é—´æˆ³å‰4ä¸ªå­—èŠ‚ä¸ºsï¼Œå4ä¸ªå­—èŠ‚ä¸ºnsã€‚

.. figure:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image23.png
   :width: 5.76736in
   :height: 3.10903in

å›¾ 5-11 æ—¶é—´åŒæ­¥æ¨¡å—éªŒè¯ç»“æœ

.. |image1| image:: ../../_static/é›†æˆæ‰‹å†Œ/EthTSyn/image7.png
   :width: 3.72569in
   :height: 3.53472in
