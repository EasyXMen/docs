=========================
CanSM
=========================




**缩写词注解**

+------------+---------------------------+----------------------------+
| **缩写词** | **英文全称**              | **中文解释**               |
+------------+---------------------------+----------------------------+
| CanSM      | CAN State Manager         | CAN状态管理                |
+------------+---------------------------+----------------------------+
| BswM       | BSW Mode Manager          | 基础软件模式管理           |
+------------+---------------------------+----------------------------+
| EcuM       | Ecu State Manager         | Ecu状态管理                |
+------------+---------------------------+----------------------------+
| CanIf      | Can Interface             | CAN接口模块                |
+------------+---------------------------+----------------------------+
| DEM        | Diagnostic Event Manager  | 诊断事件处理               |
+------------+---------------------------+----------------------------+
| DET        | Default Error Tracer      | 默认错误检测               |
+------------+---------------------------+----------------------------+
| EcuM       | ECU State Manager         | ECU状态管理模块            |
+------------+---------------------------+----------------------------+
| PN         | Partial Network           | 部分网络                   |
+------------+---------------------------+----------------------------+
| ComM       | Com Manager               | 通讯管理模块               |
+------------+---------------------------+----------------------------+



简介
====

CanSM模块负责CAN网络的控制流抽象，它使用CanIf模块的API，根据ComM模块的模式请求更改已配置的CAN网络的通信模式。CAN控制器模式和CAN收发器模式的任何更改将由CanIf模块通知CanSM模块。根据CanIf通知和CanSM状态机的状态，CanSM模块将通知ComM和BswM。

|image1|

图 CanSM在AUTOSAR中的位置

参考资料
--------

[1] AUTOSAR_SWS\_ CANStateManager.pdf，R19-11

[2] AUTOSAR_SWS_COMManager.pdf，R19-11

[3] AUTOSAR_SWS_NetworkManagementInterface.pdf，R19-11

[4] AUTOSAR_SWS_BSWModeManager.pdf，R19-11

[5] AUTOSAR_SWS\_ CANInterface.pdf，R19-11

[6] AUTOSAR_SWS_CANNetworkManagement.pdf，R19-11

功能描述
========

状态管理功能
------------

状态管理功能介绍
~~~~~~~~~~~~~~~~

CAN总线的状态管理器CanSM，负责实现CAN网络控制流程的抽象。CanSM提供API以便ComM来请求CAN网络进行通信模式的切换。ComM请求切换网络模式的时候，会传递一个参数（用来标识是哪个网络）。对应网络收到这个请求之后，会执行对应的通信模式切换。在网络通信模式切换的过程中，会执行对应的CAN外设控制和PDU处理。

不同网络请求对应的控制器和收发器状态如下：

|image2|

图 不同网络请求对应的控制器和收发器状态

由于延迟等原因，网络的通信模式可能会和ComM请求的不一致。这就需要CanSM通过以下两种方式来提供接口向ComM反馈当前的通信模式：

1)
CanSM自己提供API，ComM可以通过这个API调用来得到CAN网络当前的通信模式。

2)
CanSM使用ComM提供的回调函数来通知通信模式的改变。

状态管理功能序列图
~~~~~~~~~~~~~~~~~~

当CanSM接收到来自ComM的FULL_COMMUNICATION请求时，调用下层CanIf的接口来完成请求，请求完成后需要调用ComM回调进行通知。CanSM处理FULL_COMMUNICATION请求时序图如下。

|image3|

图 CanSM处理FULL_COMMUNICATION请求时序图

当CanSM接收到来自ComM的SILENT_COMMUNICATION请求时，需要根据配置对该Can网络的多个控制器的状态进行分别处理，请求完成后需要调用ComM回调进行通知。CanSM处理SILENT_COMMUNICATION请求时序图如下。

|image4|

图 CanSM处理SILENT_COMMUNICATION请求时序图

当CanSM接收到来自ComM的NO_COMMUNICATION请求时，调用下层CanIf的接口来完成请求，请求完成后需要调用ComM回调进行通知。CanSM处理NO_COMMUNICATION请求时序图如下。

|image5|\ 图 CanSM处理NO_COMMUNICATION请求时序图

状态管理功能主状态机
~~~~~~~~~~~~~~~~~~~~

上电后，CanSM会默认处于CANSM_BSM_S_NOT_INITIALIZED状态，在经过初始化后，状态将切换至CANSM_BSM_S_PRE_NOCOM。如果EcuM调用CanSM_StartWakeUpSource通知CanSM唤醒源被启动，那么状态机将切换至CANSM_BSM_WUVALIDATION状态。如果接收到ComM的FULL_COMMUNICATION请求，那么状态机将切换至CANSM_BSM_S_PRE_FULLCOM状态。在CanSM通知上层ComM和BSWM底层网络已经切换至FULL_COMMUNICATION，并且调用CanIf_SetPduMode更新PDU通道状态后，状态机将切换至CANSM_BSM_S_FULLCOM。

在CANSM_BSM_S_FULLCOM状态中如果接收到ComM的SILENT_COMMUNICATION请求，状态将切换至CANSM_BSM_S_SILENTCOM，或接收到ComM的NO_COMMUNICATION请求，状态将切换至CANSM_BSM_S_PRE_NOCOM。

在CANSM_BSM_S_FULLCOM状态中如果CanSM_SetBaudrate接口被上层调用，需要调用BswM_CanSM_CurrentState通知BSWM当前状态为CANSM_BSWM_CHANGE_BAUDRATE，状态机将切换至CANSM_BSM_S_CHANGE_BAUDRATE。

在CANSM_BSM_S_CHANGE_BAUDRATE中进行波特率修改的相关操作，操作结束后根据已有的ComM的网络请求状态来决定切换至哪个状态机。

|image6|

图 CanSM主状态机

Bus-off恢复功能
---------------

CanSM可以配置快恢复时间CanSMBorTimeL1和慢恢复时CanSMBorTimeL2，以及经过多少次快恢复切换为慢恢复的次数CanSMBorCounterL1ToL2。当底层发生bus-off时，会调用CanSM的CanSM_ControllerBusOff函数进行通知。CanSM会调用CanIf的CanIf_SetControllerMode函数将控制器状态设置为CAN_CS_STARTED，当接收到底层调用的CanSM_ControllerModeIndication的设置成功的通知后，开始bus-off定时器的计时，当bus-off快恢复的时间超时后，调用CanIf_SetPduMode设置Pdu传输状态为CANIF_ONLINE，当快恢复的次数超过配置参数CanSMBorCounterL1ToL2时，将按照慢恢复的时间进行恢复。

源文件描述
==========

表 CanSM组件文件描述

+-----------------------+----------------------------------------------+
| **文件**              | **说明**                                     |
+-----------------------+----------------------------------------------+
| CanSM_Cfg.h           | 用于定义CanSM模块预编译时用到的宏。          |
+-----------------------+----------------------------------------------+
| CanSM_Cfg.c           | 配置参数源文件，包含各个配置项的定义。       |
+-----------------------+----------------------------------------------+
| CanSM_BswM.h          | CanSM模块提供给BswM模块使用的类型。          |
+-----------------------+----------------------------------------------+
| CanSM_Cbk.h           | CanSM模块提                                  |
|                       | 供给CanIf,CanNm,BswM模块使用的Callback函数。 |
+-----------------------+----------------------------------------------+
| CanSM                 | 提供给CanNm的头文件，用于调用Tx传输超时函数  |
| _TxTimeoutException.h |                                              |
+-----------------------+----------------------------------------------+
| CanSM_MemMap.h        | CanSM模块函数和变量存储位置定义文件。        |
+-----------------------+----------------------------------------------+
| CanSM.h               | CanSM模块头文件，通                          |
|                       | 过加载该头文件访问CanSM公开的函数和数据类型  |
+-----------------------+----------------------------------------------+
| CanSM.c               | CanSM 模块的功能实现。                       |
+-----------------------+----------------------------------------------+

|image7|

图 CanSM组件文件交互关系图

API接口
=======

类型定义
--------

CanSM_StateType类型定义
~~~~~~~~~~~~~~~~~~~~~~~

+-----------+----------------------------------------------------------+
| 名称      | CanSM_StateType                                          |
+-----------+----------------------------------------------------------+
| 类型      | Enumeration                                              |
+-----------+----------------------------------------------------------+
| 范围      | CANSM_UNINITED                                           |
|           |                                                          |
|           | CANSM_INITED                                             |
+-----------+----------------------------------------------------------+
| 描述      | 定义 CanSM 模块初始化状态的值                            |
+-----------+----------------------------------------------------------+

CanSM_ConfigType类型定义
~~~~~~~~~~~~~~~~~~~~~~~~

+-----------+----------------------------------------------------------+
| 名称      | CanSM_ConfigType                                         |
+-----------+----------------------------------------------------------+
| 类型      | Structure                                                |
+-----------+----------------------------------------------------------+
| 范围      | --                                                       |
+-----------+----------------------------------------------------------+
| 描述      | 此类型为 CanSM 的初始化参数定义了数据结构。              |
+-----------+----------------------------------------------------------+

CanSM_BswMCurrentStateType类型定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-----------+----------------------------------------------------------+
| 名称      | CanSM_BswMCurrentStateType                               |
+-----------+----------------------------------------------------------+
| 类型      | Enumeration                                              |
+-----------+----------------------------------------------------------+
| 范围      | CANSM_BSWM_NO_COMMUNICATION                              |
|           |                                                          |
|           | CANSM_BSWM_SILENT_COMMUNICATION                          |
|           |                                                          |
|           | CANSM_BSWM_FULL_COMMUNICATION                            |
|           |                                                          |
|           | CANSM_BSWM_BUS_OFF                                       |
|           |                                                          |
|           | CANSM_BSWM_CHANGE_BAUDRATE                               |
+-----------+----------------------------------------------------------+
| 描述      | 定义 CanSM 模块通知给 BswM 模块通信状态的值              |
+-----------+----------------------------------------------------------+

输入函数描述
------------

+----------------------------------+-----------------------------------+
| **输入模块**                     | **API**                           |
+----------------------------------+-----------------------------------+
| BswM                             | Bs                                |
|                                  | wM_CanSM_CurrentIcomConfiguration |
+----------------------------------+-----------------------------------+
|                                  | BswM_CanSM_CurrentState           |
+----------------------------------+-----------------------------------+
| CanIf                            | CanIf_CheckTrcvWakeFlag           |
+----------------------------------+-----------------------------------+
|                                  | CanIf_ClearTrcvWufFlag            |
+----------------------------------+-----------------------------------+
|                                  | CanIf_GetPduMode                  |
+----------------------------------+-----------------------------------+
|                                  | CanIf_GetTxConfirmationState      |
+----------------------------------+-----------------------------------+
|                                  | CanIf_SetControllerMode           |
+----------------------------------+-----------------------------------+
|                                  | CanIf_SetPduMode                  |
+----------------------------------+-----------------------------------+
|                                  | CanIf_SetTrcvMode                 |
+----------------------------------+-----------------------------------+
| CanNm                            | CanNm_ConfirmPnAvailability       |
+----------------------------------+-----------------------------------+
| ComM                             | ComM_BusSM_ModeIndication         |
+----------------------------------+-----------------------------------+
| Dem                              | Dem_SetEventStatus                |
+----------------------------------+-----------------------------------+
| Det                              | Det_ReportRuntimeError            |
+----------------------------------+-----------------------------------+

静态接口函数定义
----------------

CanSM_Init函数定义
~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_Init        |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void CanSM_Init(  |         |                         |
|             |                   |         |                         |
|             | const             |         |                         |
|             | C                 |         |                         |
|             | anSM_ConfigType\* |         |                         |
|             | ConfigPtr         |         |                         |
|             |                   |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x00              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 不可重入          |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | ConfigPtr         | 值域：  | 指向初始化结构          |
|             |                   |         | 的指针，用于CanSM的post |
|             |                   |         | build参数               |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 完成对CanS        |         |                         |
|             | M模块的初始化处理 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_DeInit函数定义
~~~~~~~~~~~~~~~~~~~~

+-------------+--------------------------------------------------------+
| 函数名称：  | CanSM_DeInit                                           |
+-------------+--------------------------------------------------------+
| 函数原型：  | void CanSM_DeInit (                                    |
|             |                                                        |
|             | void                                                   |
|             |                                                        |
|             | )                                                      |
+-------------+--------------------------------------------------------+
| 服务编号：  | 0x14                                                   |
+-------------+--------------------------------------------------------+
| 同步/异步： | 同步                                                   |
+-------------+--------------------------------------------------------+
| 是          | 不可重入                                               |
| 否可重入：  |                                                        |
+-------------+--------------------------------------------------------+
| 输入参数：  | 无                                                     |
+-------------+--------------------------------------------------------+
| 输          | 无                                                     |
| 入输出参数: |                                                        |
+-------------+--------------------------------------------------------+
| 输出参数：  | 无                                                     |
+-------------+--------------------------------------------------------+
| 返回值：    | 无                                                     |
+-------------+--------------------------------------------------------+
| 功能概述：  | 反初始化CanSM模块                                      |
+-------------+--------------------------------------------------------+

CanSM_RequestComMode函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | Can               |         |                         |
|             | SM_RequestComMode |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | Can               |         |                         |
|             | SM_RequestComMode |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | network,          |         |                         |
|             | ComM_ModeType     |         |                         |
|             | ComMMode          |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x02              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 非同步            |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（同        |         |                         |
| 否可重入：  | 一网络不可重入）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | network           | 值域：  | 指定通信网络            |
+-------------+-------------------+---------+-------------------------+
|             | ComMMode          | 值域：  | 请求的通信模式          |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | E_OK: 服务被接受  |         |                         |
|             |                   |         |                         |
|             | E_NOT_OK:         |         |                         |
|             | 服务被拒绝        |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 将CAN网           |         |                         |
|             | 络的通信模式更改  |         |                         |
|             | 为请求的通信模式  |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_GetCurrentComMode函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM\_           |         |                         |
|             | GetCurrentComMode |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | CanSM\_           |         |                         |
|             | GetCurrentComMode |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | network,          |         |                         |
|             | ComM_ModeType\*   |         |                         |
|             | ComMModePtr       |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x03              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入            |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | network           | 值域：  | 指定通信网络            |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | ComMModePtr       | 值域：  | 指针，                  |
|             |                   |         | 保存当前通信模式的位置  |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | E_OK: 服务被接受  |         |                         |
|             |                   |         |                         |
|             | E_NOT_OK:         |         |                         |
|             | 服务被拒绝        |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 获取当前          |         |                         |
|             | 网络的通信模式。  |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_StartWakeupSource函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM\_           |         |                         |
|             | StartWakeupSource |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | CanSM\_           |         |                         |
|             | StartWakeupSource |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | network           |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x11              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 不可重入          |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | network           | 值域：  | 受影响网络              |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | E_OK: 请求成功    |         |                         |
|             |                   |         |                         |
|             | E_NOT_OK:         |         |                         |
|             | 请求被拒绝        |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 当唤醒源启动时，E |         |                         |
|             | cuM应该调用该函数 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_StopWakeupSource函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM             |         |                         |
|             | _StopWakeupSource |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | CanSM             |         |                         |
|             | _StopWakeupSource |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | network           |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x12              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 不可重入          |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | network           | 值域：  | 受影响网络              |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | E_OK: 请求成功    |         |                         |
|             |                   |         |                         |
|             | E_NOT_OK:         |         |                         |
|             | 请求被拒绝        |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 当唤醒源停止时，E |         |                         |
|             | cuM应该调用该函数 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_GetVersionInfo函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | Can               |         |                         |
|             | SM_GetVersionInfo |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | Can               |         |                         |
|             | SM_GetVersionInfo |         |                         |
|             | (                 |         |                         |
|             | Std\_             |         |                         |
|             | VersionInfoType\* |         |                         |
|             | VersionInfo       |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x01              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入            |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | versioninfo       | 值域：  | 指向存储版本信息的位置  |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 获取版本信息      |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_SetBaudrate函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_SetBaudrate |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | CanSM_SetBaudrate |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | Network,          |         |                         |
|             | uint16            |         |                         |
|             | BaudRateConfigID  |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x0d              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（同        |         |                         |
| 否可重入：  | 一网络不可重入）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | network           | 值域：  | 需要更改波特率的网络    |
+-------------+-------------------+---------+-------------------------+
|             | BaudRateConfigID  | 值域：  | 通过ID引用波特          |
|             |                   |         | 率配置(见CanController  |
|             |                   |         | BaudRateConfigID)       |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数:   | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | E_OK:             |         |                         |
|             | 接                |         |                         |
|             | 受服务请求，启动  |         |                         |
|             | (新的)波特率设置  |         |                         |
|             |                   |         |                         |
|             | E_NOT_OK:         |         |                         |
|             | 服务请求不被接受  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 该服务应          |         |                         |
|             | 启动异步过程，以  |         |                         |
|             | 更改某个CAN网络的 |         |                         |
|             | CAN控制器的波特率 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_SetEcuPassive函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | Ca                |         |                         |
|             | nSM_SetEcuPassive |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | Ca                |         |                         |
|             | nSM_SetEcuPassive |         |                         |
|             | (                 |         |                         |
|             | boolean           |         |                         |
|             | CanSM_Passive     |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x13              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 不可重入          |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | CanSM_Passive     | 值域：  | TRUE:将所有CanSM频      |
|             |                   |         | 道设置为被动，即只接收  |
|             |                   |         |                         |
|             |                   |         | FALSE:将所              |
|             |                   |         | 有CanSM通道设置为非被动 |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | E_OK: 请求被接受  |         |                         |
|             |                   |         |                         |
|             | E_NOT_OK:         |         |                         |
|             | 请求被拒绝        |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 该功能可用于将ECU |         |                         |
|             | 的所有CanSM通道设 |         |                         |
|             | 置为仅接收模式。  |         |                         |
|             | 该模式将一直保持  |         |                         |
|             | ，直到它被设置回  |         |                         |
|             | 来，或者ECU被重置 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_ControllerBusOff函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM             |         |                         |
|             | _ControllerBusOff |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanSM             |         |                         |
|             | _ControllerBusOff |         |                         |
|             | (                 |         |                         |
|             | uint8             |         |                         |
|             | ControllerId      |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x04              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（同        |         |                         |
| 否可重入：  | 一网络不可重入）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | ControllerId      | 值域：  | CAN控                   |
|             |                   |         | 制器，检测到bus-off事件 |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 此                |         |                         |
|             | 回调函数通知CanSM |         |                         |
|             | 有关某个CAN控制器 |         |                         |
|             | 上的bus-off事件， |         |                         |
|             | 需要考虑对受影响  |         |                         |
|             | 的CAN网络执行指定 |         |                         |
|             | 的bus-off恢复处理 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_ControllerModeIndication函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_Control     |         |                         |
|             | lerModeIndication |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanSM_Control     |         |                         |
|             | lerModeIndication |         |                         |
|             | (                 |         |                         |
|             | uint8             |         |                         |
|             | ControllerId,     |         |                         |
|             | Can_Co            |         |                         |
|             | ntrollerStateType |         |                         |
|             | ControllerMode    |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x07              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（同一      |         |                         |
| 否可重入：  | 控制器不可重入）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | ControllerId      | 值域：  | Can控制器Id             |
+-------------+-------------------+---------+-------------------------+
|             | ControllerMode    | 值域：  | 通知CAN控制器模式       |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 该回              |         |                         |
|             | 调应通知CanSM模块 |         |                         |
|             | CAN控制器模式改变 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_TransceiverModeIndication函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_Transcei    |         |                         |
|             | verModeIndication |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanSM_Transcei    |         |                         |
|             | verModeIndication |         |                         |
|             | (                 |         |                         |
|             | uint8             |         |                         |
|             | TransceiverId,    |         |                         |
|             | Can               |         |                         |
|             | Trcv_TrcvModeType |         |                         |
|             | TransceiverMode   |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x09              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（同        |         |                         |
| 否可重入：  | 一Trcv不可重入）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | TransceiverId     | 值域：  | CAN收发器               |
+-------------+-------------------+---------+-------------------------+
|             | TransceiverMode   | 值域：  | 收发器模式              |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 该回调应通        |         |                         |
|             | 知CanSM模块CANTr  |         |                         |
|             | ansceiver模式改变 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_TxTimeoutException函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_T           |         |                         |
|             | xTimeoutException |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanSM_T           |         |                         |
|             | xTimeoutException |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | Channel           |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x0b              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入            |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | Channel           | 值域：  | 影响网络                |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 该功能应通知      |         |                         |
|             | CanSM模块CanNm已  |         |                         |
|             | 经为受影响的部分  |         |                         |
|             | CAN网络检测到tx超 |         |                         |
|             | 时异常，该异常应  |         |                         |
|             | 在CanSM模块的相应 |         |                         |
|             | 网络状态机中恢复  |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_ClearTrcvWufFlagIndication函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_ClearTrcv   |         |                         |
|             | WufFlagIndication |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanSM_ClearTrcv   |         |                         |
|             | WufFlagIndication |         |                         |
|             | (                 |         |                         |
|             | uint8 Transceiver |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x08              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（同        |         |                         |
| 否可重入：  | 一Trcv不可重入）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | Transceiver       | 值域：  | 请求的收发器            |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 该回调函          |         |                         |
|             | 数应指示所通知的  |         |                         |
|             | CAN收发器的CanIf  |         |                         |
|             | _ClearTrcvWufFlag |         |                         |
|             | API进程结束。     |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_CheckTransceiverWakeFlagIndication函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+---------------+--------------------------------------------------------------------------+
| 函数名称：    | CanSM_CheckTransceiverWakeFlagIndication                                 |
+---------------+--------------------------------------------------------------------------+
|               | void   CanSM_CheckTransceiverWakeFlagIndication (                        |
|               +--------------------------------------------------------------------------+
| 函数原型：    | uint8 Transceiver                                                        |
|               +--------------------------------------------------------------------------+
|               | )                                                                        |
+---------------+--------------------------------------------------------------------------+
| 服务编号：    | 0x0a                                                                     |
+---------------+--------------------------------------------------------------------------+
| 同步/异步：   | 同步                                                                     |
+---------------+--------------------------------------------------------------------------+
| 是否可重入：  | 可重入（同一Trcv不可重入）                                               |
+---------------+--------------------------+---------------------+-------------------------+
| 输入参数：    | Transceiver              | 值域：              | 请求的收发器            |
+---------------+--------------------------+---------------------+-------------------------+
| 输入输出参数: | 无                                                                       |
+---------------+--------------------------------------------------------------------------+
| 输出参数：    | 无                                                                       |
+---------------+--------------------------------------------------------------------------+
| 返回值：      | 无                                                                       |
+---------------+--------------------------------------------------------------------------+
| 功能概述：    | 该回调函数应指示所通知的CAN收发器的CanIf_CheckTrcvWakeFlag API进程结束。 |
+---------------+--------------------------------------------------------------------------+

CanSM_ConfirmPnAvailability函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanSM_Conf        |         |                         |
|             | irmPnAvailability |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanSM_Conf        |         |                         |
|             | irmPnAvailability |         |                         |
|             | (                 |         |                         |
|             | uint8             |         |                         |
|             | TransceiverId     |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x06              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入            |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | TransceiverId     | 值域：  | 收发器Id                |
+-------------+-------------------+---------+-------------------------+
| 输          | 无                |         |                         |
| 入输出参数: |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 此回调函          |         |                         |
|             | 数表明收发器正在  |         |                         |
|             | PN通信模式下运行  |         |                         |
+-------------+-------------------+---------+-------------------------+

CanSM_MainFunction函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+--------------------------------------------------------+
| 函数名称：  | CanSM_MainFunction                                     |
+-------------+--------------------------------------------------------+
| 函数原型：  | void CanSM_MainFunction (                              |
|             | void                                                   |
|             | )                                                      |
+-------------+--------------------------------------------------------+
| 服务编号：  | 0x05                                                   |
+-------------+--------------------------------------------------------+
| 功能概述：  | CanSM的周期功能                                        |
+-------------+--------------------------------------------------------+

可配置函数定义
--------------

<User_GetBusOffDelay>函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | <Use              |         |                         |
|             | r_GetBusOffDelay> |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | <Use              |         |                         |
|             | r_GetBusOffDelay> |         |                         |
|             | (                 |         |                         |
|             | NetworkHandleType |         |                         |
|             | network,          |         |                         |
|             | uint8\*           |         |                         |
|             | delayCyclesPtr    |         |                         |
|             | )                 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 可重入（仅        |         |                         |
| 否可重入：  | 对于不同的网络）  |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | network           | 值域：  | 发生 BusOff 的 CAN      |
|             |                   |         | 网络。                  |
+-------------+-------------------+---------+-------------------------+
| 输入        | 无                |         |                         |
| 输出参数：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | delayCyclesPtr    | 值域：  | 发生 BusOff 后，在      |
|             |                   |         | L1/L2 之外等待的 CanSM  |
|             |                   |         | 基本周期数。            |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 在发生 BusOff     |         |                         |
|             | 后，此调用函      |         |                         |
|             | 数返回要额外等待  |         |                         |
|             | L1/L2 的 CanSM    |         |                         |
|             | 基本周期数。      |         |                         |
+-------------+-------------------+---------+-------------------------+

配置
====

CanSMGeneral
------------

|image8|

图 CanSMGeneral容器配置图

表  CanSMGeneral属性描述

+--------+-----------+-----------------------+-----------+------------+
| **UI   | **描述**  |                       |           |            |
| 名称** |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
| C      | 取值范围  | TRUE,FALSE            | 默认取值  | FALSE      |
| anSMDe |           |                       |           |            |
| vError |           |                       |           |            |
| Detect |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 打开                  |           |            |
|        |           | 或关闭默认错误跟踪器  |           |            |
|        |           | (Det) 检测和通知。    |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Can    | 取值范围  | FunctionName          | 默认取值  | 无         |
| SMGetB |           |                       |           |            |
| usOffD |           |                       |           |            |
| elayFu |           |                       |           |            |
| nction |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 该参                  |           |            |
|        |           | 数配置<User_GetBusOf  |           |            |
|        |           | fDelay>调用函数的名称 |           |            |
|        |           | ，CanSM使用该函数获取 |           |            |
|        |           | 额外的L1/L2延迟时间。 |           |            |
|        |           | 此函数仅在C           |           |            |
|        |           | anSMEnableBusOffDelay |           |            |
|        |           | 已启用的通道中调用。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| C      | 取值范围  | String                | 默认取值  | 无         |
| anSMGe |           |                       |           |            |
| tBusOf |           |                       |           |            |
| fDelay |           |                       |           |            |
| Header |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 此参数配置包含        |           |            |
|        |           | <User_GetBusOffDelay> |           |            |
|        |           | call                  |           |            |
|        |           | out函数原型的头文件。 |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Can    | 取值范围  | 0 .. INF              | 默认取值  | 无         |
| SMMain |           |                       |           |            |
| Functi |           |                       |           |            |
| onTime |           |                       |           |            |
| Period |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 该参                  |           |            |
|        |           | 数以秒为单位定义函数  |           |            |
|        |           | CanSM_MainFunction    |           |            |
|        |           | 的循环时间            |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Can    | 取值范围  | TRUE,FALSE            | 默认取值  | FALSE      |
| SMPncS |           |                       |           |            |
| upport |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 启用或                |           |            |
|        |           | 禁用对PN网络的支持。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 只有在 ComM 中启用了  |           |            |
|        |           | ComMPncSupport        |           |            |
|        |           | 时，此参数才可用      |           |            |
+--------+-----------+-----------------------+-----------+------------+
| C      | 取值范围  | TRUE,FALSE            | 默认取值  | FALSE      |
| anSMSe |           |                       |           |            |
| tBaudr |           |                       |           |            |
| ateApi |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | Can_SetBaudrate API   |           |            |
|        |           | 的支持是可选的。      |           |            |
|        |           | 如果此参数设置为      |           |            |
|        |           | true，则应支持        |           |            |
|        |           | Can_SetBaudrate API。 |           |            |
|        |           | 否则不支持 API。      |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Can    | 取值范围  | TRUE,FALSE            | 默认取值  | 无         |
| SMTxOf |           |                       |           |            |
| flineA |           |                       |           |            |
| ctiveS |           |                       |           |            |
| upport |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 确定 CanSM 是否支持   |           |            |
|        |           | ECU 被动功能。        |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 依赖CanIfT            |           |            |
|        |           | xOfflineActiveSupport |           |            |
+--------+-----------+-----------------------+-----------+------------+
| C      | 取值范围  | TRUE,FALSE            | 默认取值  | FALSE      |
| anSMVe |           |                       |           |            |
| rsionI |           |                       |           |            |
| nfoApi |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 使能版本信息API       |           |            |
|        |           | (Ca                   |           |            |
|        |           | nSM_GetVersionInfo)。 |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanSMM | 取值范围  | TRUE,FALSE            | 默认取值  | FALSE      |
| ultipl |           |                       |           |            |
| eContr |           |                       |           |            |
| ollerS |           |                       |           |            |
| upport |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 启用/禁用为网络分     |           |            |
|        |           | 配多个控制器的功能。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+

CanSMConfiguration
------------------

|image9|

图 CanSMConfiguration容器配置图

表  CanSMConfiguration属性描述

+--------+-----------+-----------------------+-----------+------------+
| **UI   | **描述**  |                       |           |            |
| 名称** |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanSM  | 取值范围  | 0 .. 255              | 默认取值  | 无         |
| ModeRe |           |                       |           |            |
| questR |           |                       |           |            |
| epetit |           |                       |           |            |
| ionMax |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 没有来自 CanIf        |           |            |
|        |           | 模块的相应模          |           |            |
|        |           | 式指示，指定模式请求  |           |            |
|        |           | 重复的最大数量，直到  |           |            |
|        |           | CanSM 模块向 Det      |           |            |
|        |           | 报告开发错误并        |           |            |
|        |           | 尝试返回无通信状态。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanSMM | 取值范围  | 0 .. 65.535           | 默认取值  | 无         |
| odeReq |           |                       |           |            |
| uestRe |           |                       |           |            |
| petiti |           |                       |           |            |
| onTime |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 通过使用 CanIf 模块的 |           |            |
|        |           | API，指定 CanSM       |           |            |
|        |           | 模块应在多长时间      |           |            |
|        |           | 内重复模式更改请求。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+

CanSMManagerNetwork
~~~~~~~~~~~~~~~~~~~

|image10|

图 CanSMManagerNetwork容器配置图

表  CanSMManagerNetwork属性描述

+--------+-----------+-----------------------+-----------+------------+
| **UI   | **描述**  |                       |           |            |
| 名称** |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Can    | 取值范围  | 0 .. 255              | 默认取值  | 无         |
| SMBorC |           |                       |           |            |
| ounter |           |                       |           |            |
| L1ToL2 |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 该阈                  |           |            |
|        |           | 值定义了bus-off计数， |           |            |
|        |           | 直到bus-off恢复从级别 |           |            |
|        |           | 1（快                 |           |            |
|        |           | 恢复时间）切换到级别  |           |            |
|        |           | 2（慢恢复时间）。     |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Ca     | 取值范围  | 0 .. 65.535           | 默认取值  | 无         |
| nSMBor |           |                       |           |            |
| TimeL1 |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 该时间参数            |           |            |
|        |           | 以秒为单位定义了级别  |           |            |
|        |           | 1                     |           |            |
|        |           | 中bus-off恢复时间的持 |           |            |
|        |           | 续时间（快恢复时间）  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Ca     | 取值范围  | 0 .. 65.535           | 默认取值  | 无         |
| nSMBor |           |                       |           |            |
| TimeL2 |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 该时间参数            |           |            |
|        |           | 以秒为单位定义了级别  |           |            |
|        |           | 2（                   |           |            |
|        |           | 慢恢复时间）中bus-of  |           |            |
|        |           | f恢复时间的持续时间。 |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| Can    | 取值范围  | 0 .. 65.535           | 默认取值  | 无         |
| SMBorT |           |                       |           |            |
| imeTxE |           |                       |           |            |
| nsured |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 该参数以秒为单        |           |            |
|        |           | 位定义bus-off事件检查 |           |            |
|        |           | 的持续时间。该检查评  |           |            |
|        |           | 估在恢复重新启用传输  |           |            |
|        |           | 路径后恢复是否成功。  |           |            |
|        |           | 如果在此时间段内发    |           |            |
|        |           | 生新的bus-off，CanSM  |           |            |
|        |           | 会将此bus-off评估为顺 |           |            |
|        |           | 序总线关闭，而没有成  |           |            |
|        |           | 功恢复。因为只能检测  |           |            |
|        |           | 到bus-off，所以在传输 |           |            |
|        |           | PDU                   |           |            |
|        |           | 时，时间必须          |           |            |
|        |           | 足够长以确保再次传输  |           |            |
|        |           | PDU（例如，COM        |           |            |
|        |           | 模块的最快循环传输    |           |            |
|        |           | PDU 的时间段 /        |           |            |
|        |           | ComTxMod              |           |            |
|        |           | eTimePeriodFactor）。 |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | CanSMBorTxConf        |           |            |
|        |           | irmationPolling不使能 |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanSM  | 取值范围  | TRUE,FALSE            | 默认取值  | 无         |
| BorTxC |           |                       |           |            |
| onfirm |           |                       |           |            |
| ationP |           |                       |           |            |
| olling |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 如果 CanSM 轮询       |           |            |
|        |           | CanIf_G               |           |            |
|        |           | etTxConfirmationState |           |            |
|        |           | API                   |           |            |
|        |           | 来决                  |           |            |
|        |           | 定要恢复的bus-off状态 |           |            |
|        |           | ，而不是为此决定使用  |           |            |
|        |           | CanSMBorTimeTxEnsured |           |            |
|        |           | 参数，                |           |            |
|        |           | 则该参数应进行配置。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanS   | 取值范围  | TRUE,FALSE            | 默认取值  | FALSE      |
| MEnabl |           |                       |           |            |
| eBusOf |           |                       |           |            |
| fDelay |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 此参数定              |           |            |
|        |           | 义是否应为此网络调用  |           |            |
|        |           | <U                    |           |            |
|        |           | ser_GetBusOffDelay>。 |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 无                    |           |            |
+--------+-----------+-----------------------+-----------+------------+
| C      | 取值范围  | reference to [        | 默认取值  | 无         |
| anSMCo |           | ComMChannel ]         |           |            |
| mMNetw |           |                       |           |            |
| orkHan |           |                       |           |            |
| dleRef |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 唯一                  |           |            |
|        |           | 的ID来识别一个特定的  |           |            |
|        |           | CAN 网络。 引用为     |           |            |
|        |           | ComM                  |           |            |
|        |           | 配置的网络ID之一。    |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 依赖ComMChannel       |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanSMT | 取值范围  | reference to [        | 默认取值  | 无         |
| ransce |           | CanIfTrcvCfg ]        |           |            |
| iverId |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 分配给配置的网络的    |           |            |
|        |           | CAN 收发器的          |           |            |
|        |           | ID。引用CanIf         |           |            |
|        |           | 模                    |           |            |
|        |           | 块管理的收发器之一。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 依赖CanIfTrcvCfg      |           |            |
+--------+-----------+-----------------------+-----------+------------+

CanSMController
~~~~~~~~~~~~~~~

|image11|

图 CanSMController容器配置图

表  CanSMController属性描述

+--------+-----------+-----------------------+-----------+------------+
| **UI   | **描述**  |                       |           |            |
| 名称** |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CanSM  | 取值范围  | reference to          | 默认取值  | 无         |
| Contro |           | [CanIfCtrlCfg]        |           |            |
| llerId |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 分配给配置的网络的    |           |            |
|        |           | CAN 控制器的          |           |            |
|        |           | ID。引用CanIf         |           |            |
|        |           | 模                    |           |            |
|        |           | 块管理的控制器之一。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 依赖 CanIfCtrlCfg     |           |            |
+--------+-----------+-----------------------+-----------+------------+

CanSMDemEventParameterRefs
~~~~~~~~~~~~~~~~~~~~~~~~~~

|image12|

图 3CanSMDemEventParameterRefs容器配置图

表  3CanSMDemEventParameterRefs属性描述

+--------+-----------+-----------------------+-----------+------------+
| **UI   | **描述**  |                       |           |            |
| 名称** |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CAN    | 取值范围  | reference to          | 默认取值  | 无         |
| SM_E_B |           | [DemEventParameter]   |           |            |
| US_OFF |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 引用已经配置的Dem事件 |           |            |
|        |           | 用来报告BUSOFF错误。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 依赖                  |           |            |
|        |           | DemEventParameter     |           |            |
+--------+-----------+-----------------------+-----------+------------+
| CANS   | 取值范围  | reference to          | 默认取值  | 无         |
| M_E_MO |           | [DemEventParameter]   |           |            |
| DE_REQ |           |                       |           |            |
| UEST_T |           |                       |           |            |
| IMEOUT |           |                       |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 参数描述  | 引用已经配置的Dem事件 |           |            |
|        |           | 用来报告对控制器或收  |           |            |
|        |           | 发器控制的超时错误。  |           |            |
+--------+-----------+-----------------------+-----------+------------+
|        | 依赖关系  | 依赖                  |           |            |
|        |           | DemEventParameter     |           |            |
+--------+-----------+-----------------------+-----------+------------+

.. |image1| image:: ../../_static/参考手册/CanSM/image1.png
   :width: 5.76736in
   :height: 3.43056in
.. |image2| image:: ../../_static/参考手册/CanSM/image2.png
   :width: 5.76736in
   :height: 2.55625in
.. |image3| image:: ../../_static/参考手册/CanSM/image3.png
   :width: 5.74167in
   :height: 6.22569in
.. |image4| image:: ../../_static/参考手册/CanSM/image4.png
   :width: 5.76736in
   :height: 5.0375in
.. |image5| image:: ../../_static/参考手册/CanSM/image5.png
   :width: 5.74792in
   :height: 7.86944in
.. |image6| image:: ../../_static/参考手册/CanSM/image6.png
   :width: 5.76736in
   :height: 7.71458in
.. |image7| image:: ../../_static/参考手册/CanSM/image7.png
   :width: 5.76736in
   :height: 1.18819in
.. |image8| image:: ../../_static/参考手册/CanSM/image8.png
   :width: 5.6697in
   :height: 4.12014in
.. |image9| image:: ../../_static/参考手册/CanSM/image9.png
   :width: 5.76736in
   :height: 0.90972in
.. |image10| image:: ../../_static/参考手册/CanSM/image10.png
   :width: 5.76736in
   :height: 1.47778in
.. |image11| image:: ../../_static/参考手册/CanSM/image11.png
   :width: 5.76736in
   :height: 1.33194in
.. |image12| image:: ../../_static/参考手册/CanSM/image12.png
   :width: 5.76736in
   :height: 1.37361in
