=====================
CanTp
=====================




**缩写词注解**

+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| 缩写词 |                                                                英文全名                                                               |      解释/描述     |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| CanTp  | CAN Transport   Layer                                                                                                                 | Can传输层模块      |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| SF     | Single Frame                                                                                                                          | 单帧               |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| CF     | Consecutive   Frame                                                                                                                   | 连续帧             |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| FC     | Flow Control                                                                                                                          | 流控帧             |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| FF     | First Frame                                                                                                                           | 首帧               |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| N_Data | Data   information of the transport layer                                                                                             | 传输层数据信息     |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| N_PCI  | Protocol   Control Information of the transport layer                                                                                 | 传输层协议控制信息 |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| N_SA   | Network Source   Address (see ISO 15765-2).                                                                                           | 网络源地址         |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| N_TA   | Network Target   Address (see ISO 15765-2). It might already contain the   N_TAtype(physical/function) in case of ExtendedAddressing. | 网络目标地址       |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| FS     | Flow Status                                                                                                                           | 流控状态           |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| TP     | Transport   Protocol                                                                                                                  | 传输协议           |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| SDU    | Service Data   Unit                                                                                                                   | 服务数据单元       |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| PduR   | PDU Router                                                                                                                            | PDU路由模块        |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| PDU    | Protocol Data   Unit                                                                                                                  | 协议数据单元       |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| BS     | Block Size                                                                                                                            | 块大小             |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+
| CanIf  | CAN Interface                                                                                                                         | Can接口层模块      |
+--------+---------------------------------------------------------------------------------------------------------------------------------------+--------------------+



简介
====

|image1|\ 图 CanTp模块层次图

CanTp模块实现依据ISO15765-2标准规范中定义的CAN总线数据在传输层的数据接收发送功能。在ISO15765-2中，CanTp模块需要实现数据的发送拆包、接收数据重组、数据流控和错误处理机制，需要支持CANFD、MetaData、半双工通信与全双工通信。按照AUTOSAR标准规范的定义，CanTp模块还实现了发送请求的取消处理。

按照AUTOSAR规范，CanTp模块能够同时处理多个连接(即多个分段会话并行)，但是只支持事件触发模式。因为CanTp只处理传输协议帧(即SF、FF、CF和FC)，根据N-PDU
ID, CanIf接口必须将I-PDU转发给CanTp或PduR。

CanTp模块支持大数据拆包组包以及流控：对于小数据使用单帧进行传输，CAN帧数据长度小于8字节或者63字节（CAN_FD情况下）（包括N_PCI信息），无流控握手。传输过程如图 所示。

|image2|

图 单帧传输过程

对于大数据使用多帧传输，数据包发送时拆包分段发送，数据包接收时重组，并使用流控握手与定时控制，使用到的帧类型包括：首帧、流控帧与连续帧。传输过程如图 所示。

|image3|

图 多帧传输过程

如图 表示了CanTp模块需要使用的上下层模块CanIf和PduR。

CanTp模块提供上层接口给PduR模块交互，用来接收与发送数据。两个模块之间通过N_SDU进行交互。CanTp使用PduR的回调函数复制发送数据，确认发送，发起接收，复制接收数据，接收指引。

CanTp模块提供下层接口给CanIf模块交互，用来接收与发送数据。两个模块之间通过L_SDU进行交互。CanTp使用CanIf的发送接口进行数据发送。\ |image4|

图 CanTp与其他模块交互图

参考资料
--------

[1] ISO15765-2，2016

[2] AUTOSAR_SWS_CANTransportLayer, 4.2.2

[3] AUTOSAR_SWS_CANTransportLayer, R19-11

[4] AUTOSAR_SWS_CANInterface, R19-11

[5] AUTOSAR_SWS_PDURouter, R19-11

[6] AUTOSAR_SWS_TimeService, R19-11

功能描述
========

SF接收功能
----------

SF接收功能介绍
~~~~~~~~~~~~~~

当接收到一个单帧报文时，CanTp模块会解析单帧报文的控制信息，并根据相关配置判断是否进行接收，如果通过检查则通知上层，并根据上层的状态信息将接收的数据传递给上层模块。

SF接收功能实现
~~~~~~~~~~~~~~

当底层接收到一个SF时，CanIf通过CanTp_RxIndication回调通知CanTp。CanTp执行PDU
ID转换并从N-PDU有效载荷中提取有用的数据长度。然后，CanTp使用PduR\_<LoTp>StartOfReception回调为这个传入数据请求上层提供一个缓冲区。将TpSduLength设置为SF_DL(从N-PCI字段提取)。它表示要接收的总字节数。如果上层没有任何缓冲区可用，返回BUFREQ_E_NOT_OK。CanTp在不复制任何数据的情况下结束CanTp_RxIndication。如果上层分配并锁定所需的Rx缓冲区，然后返回BUFREQ_E_OK。然后CanTp调用PduR\_<LoTp>CopyRxData让上层将接收到的N-PDU有效载荷复制到缓冲区中。当复制完成时，CanTp接着调用PduR\_<User：LoTp>RxIndication结果设置为E_OK，告知上层数据传递完成。CanTp结束CanTp_RxIndication函数。

SF发送功能
----------

SF发送功能介绍
~~~~~~~~~~~~~~

当需要发送一个单帧报文时，CanTp模块会根据请求信息添加单帧报文的控制信息，然后请求CanIf模块进行SF发送。

SF发送功能实现
~~~~~~~~~~~~~~

当PDUR需要传输一个SF时，PDUR调用CanTp_Transmit传入相关数据，CanTp模块检查输入数据，如果检查通过，则返回E_OK，以指示接受传输请求。上层锁定所需的Tx缓冲区。接下来CanTp会调用PduR\_<LoTp>CopyTxData来复制段数据。上层复制数据，然后返回BUFREQ_E_OK。CanTp在拷贝的数据基础上添加控制信息，然后调用CanIf_Transmit请求CanIf模块执行发送。CanIf模块处理发送请求，成功发送后CanIf调用CanTp_TxConfirmation通知CanTp发送成功。然后CanTp调用PduR\_<User：LoTp>TxConfirmation通知PDUR已经成功传输。

多帧接收功能
------------

多帧接收功能介绍
~~~~~~~~~~~~~~~~

当接收到一个多帧报文时，CanTp模块会解析首帧报文的控制信息，并根据相关配置判断是否进行接收，如果通过检查则通知上层，并根据上层的状态信息将接收的数据传递给上层模块。首帧处理完成之后，发送方会在规定时间内响应一个流控帧，若流控状态为ContinueToSend，CanTp会继续接收连续帧并向上层传递。当接收完成时通知上层接收完成。

多帧接收功能实现
~~~~~~~~~~~~~~~~

当接收到一个FF时，CanIf通过CanTp_RxIndication回调通知CanTp。CanTp解析FF的控制信息后，CanTp使用PduR\_<LoTp>StartOfReception回调请求PDUR为传入的数据提供一个缓冲区。检查连接验收并准备FC参数。CanTp激活一个FC发送任务，发送一个流状态设置为ContinueToSend的FC（这里FC的状态需要根据上层的返回信息进行相应的FC状态设置）。该FC通过请求CanIf_Transmit进行发送，同时CanTp会调用PduR\_<LoTp>CopyRxData将FF数据传递给上层，然后等待CF的接收。

当接收到一个CF时，CanIf通过CanTp_RxIndication回调通知CanTp。CanTp将验证序列号，若正确，则要求PduR复制数据，并可能会发生以下情况：

非最后一帧CF:
CanTp将调用PduR\_<LoTp>CopyRxData把接收到的数据转发到上层。（如果此时BS达到则请求发送一个FC，然后继续接收CF）

最后一帧CF:
这个连续帧是最后一个(根据FF中的总长度信息判断)。调用PduR\_<LoTp>CopyRxData将数据拷贝完成后，CanTp应该用PduR\_<User：LoTp>RxIndication回调来通知PDUR。

当需要发送FC时，CanTp会调用CanIf_Transmit接口，并等待确认。根据上层的可用缓冲区，流控状态可以是ContinueToSend，也可以是Wait。

多帧发送功能
------------

多帧发送功能介绍
~~~~~~~~~~~~~~~~

当需要发送一个多帧报文时，CanTp模块会添加首帧报文的控制信息，并在FF发送成功后等待接收一个FC。当接收到的FC所带状态信息为CTS时，将接下来的数据进行发送，并填充成CF，如果发送的CF个数达到FC所带的BS，则需要等待下一个FC，直到数据发送完成。

多帧发送功能实现
~~~~~~~~~~~~~~~~

PDUR需要传输一个多帧数据时，会调用CanTp的CanTp_Transmit。CanTp会验证输入参数和资源的可用性，并根据发送请求的有用信息(例如SF/FF/CF
N-PDU标识符、FC N-PDU标识符、N_TA值等)启动带有参数的内部传输任务。

CanTp在接下来调用PduR\_<LoTp>CopyTxData。上层将数据复制到目标缓冲区。在发送任务中，CanTp通过CanIf_Transmit通知CanIf，
CanTp等待来自CanIf的确认(CanTp_TxConfirmation)，然后等待接收一个状态为CTS的FC。接收FC成功后，CanTp
要求PDUR提供要发送的新数据用于发送CF，或发生错误时，CanTp使用PduR\_<User：LoTp>TxConfirmation通知PDUR。整个过程中根据BS可能需要接收多次FC。

源文件描述
==========

表 CanTp组件文件描述

+---------------------+------------------------------------------------+
| **文件**            | **说明**                                       |
+---------------------+------------------------------------------------+
| CanTp.c             | CanTp模块源文件，包含了API函数的实现。         |
+---------------------+------------------------------------------------+
| CanTp.h             | CanTp模块头文件，包                            |
|                     | 含了API函数的扩展声明并定义了端口的数据结构。  |
+---------------------+------------------------------------------------+
| CanTp_Internal.c    | 定义CanTp模块一些内部接口。                    |
+---------------------+------------------------------------------------+
| CanTp_Internal.h    | 包含CanTp模块需要使用的部分类型定义和宏定义。  |
+---------------------+------------------------------------------------+
| CanTp_Types.h       | 包含CanTp模块需要使用的类型定义。              |
+---------------------+------------------------------------------------+
| CanTp_Cbk.h         | CanTp模块回调接口相关头文件，包含了回调接口    |
|                     | 相关API函数的扩展声明并定义了端口的数据结构。  |
+---------------------+------------------------------------------------+
| CanTp_MemMap.h      | 包含CanTp模块的内存抽象。                      |
+---------------------+------------------------------------------------+
| CanTp_Callout.c     | 定义CanTp模块计时的方法。                      |
+---------------------+------------------------------------------------+
| CanTp_Cfg.h         | 定义CanTp模块预编译时用到的配置参数。          |
+---------------------+------------------------------------------------+
| CanTp_PBCfg.c       | 定义CanTp模块配置相关的配置参数。              |
+---------------------+------------------------------------------------+
| CanTp_PBCfg.h       | 包含CanTp模块配置相关的配置参数。              |
+---------------------+------------------------------------------------+

|image5|

图 CanTp组件文件交互关系图

API接口
=======

类型定义
--------

CanTp_ConfigType类型定义
~~~~~~~~~~~~~~~~~~~~~~~~

+-----------+----------------------------------------------------------+
| 名称      | CanTp_ConfigType                                         |
+-----------+----------------------------------------------------------+
| 类型      | Structure                                                |
+-----------+----------------------------------------------------------+
| 范围      | 无                                                       |
+-----------+----------------------------------------------------------+
| 描述      | 配置参数结构体类型定义                                   |
+-----------+----------------------------------------------------------+

输入函数描述
------------

+----------------------------------+-----------------------------------+
| **输入模块**                     | **API**                           |
+----------------------------------+-----------------------------------+
| Det                              | Det_ReportError                   |
+----------------------------------+-----------------------------------+
|                                  | Det_ReportRuntimeError            |
+----------------------------------+-----------------------------------+
| CanIf                            | CanIf_Transmit                    |
+----------------------------------+-----------------------------------+
| PduR                             | PduR_CanTpCopyRxData              |
+----------------------------------+-----------------------------------+
|                                  | PduR_CanTpCopyTxData              |
+----------------------------------+-----------------------------------+
|                                  | PduR_CanTpRxIndication            |
+----------------------------------+-----------------------------------+
|                                  | PduR_CanTpStartOfReception        |
+----------------------------------+-----------------------------------+
|                                  | PduR_CanTpTxConfirmation          |
+----------------------------------+-----------------------------------+
| Tm                               | Tm_ResetTimer100us32bit           |
+----------------------------------+-----------------------------------+
|                                  | Tm_GetTimeSpan100us32bit          |
+----------------------------------+-----------------------------------+
| Os                               | GetElapsedValue                   |
+----------------------------------+-----------------------------------+
| SchM                             | SchM_Enter_CanTp_ExclusiveArea    |
+----------------------------------+-----------------------------------+
|                                  | SchM_Exit_CanTp_ExclusiveArea     |
+----------------------------------+-----------------------------------+

静态接口函数定义
----------------

CanTp_Init函数定义
~~~~~~~~~~~~~~~~~~

+-------------+------------------------+-----------+-----------------+
| 函数名称：  | CanTp_Init             |           |                 |
+-------------+------------------------+-----------+-----------------+
| 函数原型：  | void CanTp_Init(const  |           |                 |
|             | CanTp_ConfigType\*     |           |                 |
|             | CfgPtr)                |           |                 |
+-------------+------------------------+-----------+-----------------+
| 服务编号：  | 0x01                   |           |                 |
+-------------+------------------------+-----------+-----------------+
| 同步/异步： | 同步                   |           |                 |
+-------------+------------------------+-----------+-----------------+
| 是          | 否                     |           |                 |
| 否可重入：  |                        |           |                 |
+-------------+------------------------+-----------+-----------------+
| 输入参数：  | CfgPtr：配置数据结构体 | 值域：    | 无              |
+-------------+------------------------+-----------+-----------------+
| 输入        | 无                     |           |                 |
| 输出参数：  |                        |           |                 |
+-------------+------------------------+-----------+-----------------+
| 输出参数：  | 无                     |           |                 |
+-------------+------------------------+-----------+-----------------+
| 返回值：    | 无                     |           |                 |
+-------------+------------------------+-----------+-----------------+
| 功能概述：  | 初始化CanTp模块        |           |                 |
+-------------+------------------------+-----------+-----------------+

CanTp_GetVersionInfo函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | Can               |         |                         |
|             | Tp_GetVersionInfo |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanTp_Ge          |         |                         |
|             | tVersionInfo(Std\_|         |                         |
|             | VersionInfoType\* |         |                         |
|             |                   |         |                         |
|             | versioninfo)      |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x07              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 是                |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | 无                | 值域：  | 无                      |
+-------------+-------------------+---------+-------------------------+
| 输入        | 无                |         |                         |
| 输出参数：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | versioni          |         |                         |
|             | nfo：版本信息参数 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 获取              |         |                         |
|             | CanTp模块版本信息 |         |                         |
+-------------+-------------------+---------+-------------------------+

CanTp_Shutdown函数定义
~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanTp_Shutdown    |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | Can               |         |                         |
|             | Tp_Shutdown(void) |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x02              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 否                |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | 无                | 值域：  | 无                      |
+-------------+-------------------+---------+-------------------------+
| 输入        | 无                |         |                         |
| 输出参数：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 关闭CanTp模块     |         |                         |
+-------------+-------------------+---------+-------------------------+

CanTp_Transmit函数定义
~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | CanTp_Transmit    |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | Std_ReturnType    |         |                         |
|             | CanTp_T           |         |                         |
|             | ransmit(PduIdType |         |                         |
|             | TxPduId, const    |         |                         |
|             | PduInfoType\*     |         |                         |
|             | PduInfoPtr)       |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x03              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 是                |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | TxPduId           | 值域：  | 无                      |
+-------------+-------------------+---------+-------------------------+
|             | PduInfoPtr        | 值域：  | 无                      |
+-------------+-------------------+---------+-------------------------+
| 输入        | 无                |         |                         |
| 输出参数：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | Std_ReturnType：  |         |                         |
|             |                   |         |                         |
|             | E_OK：请求成功    |         |                         |
|             |                   |         |                         |
|             | E                 |         |                         |
|             | _NOT_OK：请求失败 |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | 数据传输请求接口  |         |                         |
+-------------+-------------------+---------+-------------------------+

CanTp_CancelTransmit函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+----------------------------------------+--------+----+
| 函数名称：  | CanTp_CancelTransmit                   |        |    |
+-------------+----------------------------------------+--------+----+
| 函数原型：  | Std_ReturnType                         |        |    |
|             | CanTp_CancelTransmit(PduIdType         |        |    |
|             | TxPduId)                               |        |    |
+-------------+----------------------------------------+--------+----+
| 服务编号：  | 0x08                                   |        |    |
+-------------+----------------------------------------+--------+----+
| 同步/异步： | 同步                                   |        |    |
+-------------+----------------------------------------+--------+----+
| 是          | 否                                     |        |    |
| 否可重入：  |                                        |        |    |
+-------------+----------------------------------------+--------+----+
| 输入参数：  | TxPduId：请求取消传输的N-SDU ID        | 值域： | 无 |
+-------------+----------------------------------------+--------+----+
| 输入        | 无                                     |        |    |
| 输出参数：  |                                        |        |    |
+-------------+----------------------------------------+--------+----+
| 输出参数：  | 无                                     |        |    |
+-------------+----------------------------------------+--------+----+
| 返回值：    | Std_ReturnType E_OK ：成功 E_NOT_OK：  |        |    |
|             | 不成功                                 |        |    |
+-------------+----------------------------------------+--------+----+
| 功能概述：  | 取消发送                               |        |    |
+-------------+----------------------------------------+--------+----+

CanTp_CancelReceive函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+---------------------------------------+-------+------+
| 函数名称：  | CanTp_CancelReceive                   |       |      |
+-------------+---------------------------------------+-------+------+
| 函数原型：  | Std_ReturnType                        |       |      |
|             | CanTp_CancelReceive(PduIdType         |       |      |
|             | RxPduId)                              |       |      |
+-------------+---------------------------------------+-------+------+
| 服务编号：  | 0x09                                  |       |      |
+-------------+---------------------------------------+-------+------+
| 同步/异步： | 同步                                  |       |      |
+-------------+---------------------------------------+-------+------+
| 是          | 否                                    |       |      |
| 否可重入：  |                                       |       |      |
+-------------+---------------------------------------+-------+------+
| 输入参数：  | RxPduId：请求取消接收的N-SDU ID       | 值    | 无   |
|             |                                       | 域：  |      |
+-------------+---------------------------------------+-------+------+
| 输入        | 无                                    |       |      |
| 输出参数：  |                                       |       |      |
+-------------+---------------------------------------+-------+------+
| 输出参数：  | 无                                    |       |      |
+-------------+---------------------------------------+-------+------+
| 返回值：    | Std_ReturnType E_OK ：成功 E_NOT_OK： |       |      |
|             | 不成功                                |       |      |
+-------------+---------------------------------------+-------+------+
| 功能概述：  | 请求取消接收接口                      |       |      |
+-------------+---------------------------------------+-------+------+

CanTp_ChangeParameter函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+--------------------------------+-----------+----------+
| 函数名称：  | CanTp_ChangeParameter          |           |          |
+-------------+--------------------------------+-----------+----------+
| 函数原型：  | Std_ReturnType                 |           |          |
|             | C                              |           |          |
|             | anTp_ChangeParameter(PduIdType |           |          |
|             | id,                            |           |          |
|             |                                |           |          |
|             | TPParameterType parameter,     |           |          |
|             | uint16 value)                  |           |          |
+-------------+--------------------------------+-----------+----------+
| 服务编号：  | 0x4b (R19-11)                  |           |          |
+-------------+--------------------------------+-----------+----------+
| 同步/异步： | 同步                           |           |          |
+-------------+--------------------------------+-----------+----------+
| 是          | 否                             |           |          |
| 否可重入：  |                                |           |          |
+-------------+--------------------------------+-----------+----------+
| 输入参数：  | id接收的N-SDU ID值             | 值域：    | 无       |
+-------------+--------------------------------+-----------+----------+
|             | parameter请求修改的参数类型    | 值域：    | 无       |
+-------------+--------------------------------+-----------+----------+
|             | value请求修改为的值            | 值域：    | 无       |
+-------------+--------------------------------+-----------+----------+
| 输入        | 无                             |           |          |
| 输出参数：  |                                |           |          |
+-------------+--------------------------------+-----------+----------+
| 输出参数：  | 无                             |           |          |
+-------------+--------------------------------+-----------+----------+
| 返回值：    | Std_ReturnType E_OK ：成功     |           |          |
|             | E_NOT_OK： 不成功              |           |          |
+-------------+--------------------------------+-----------+----------+
| 功能概述：  | 请求修改接收参数，如BS、STmin  |           |          |
+-------------+--------------------------------+-----------+----------+

CanTp_ReadParameter函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------------------------+--------+--------+
| 函数名称：  | CanTp_ReadParameter                 |        |        |
+-------------+-------------------------------------+--------+--------+
| 函数原型：  | Std_ReturnType                      |        |        |
|             |                                     |        |        |
|             | CanTp_ReadParameter(PduIdType id,   |        |        |
|             | TPParameterType parameter, uint16\* |        |        |
|             | value)                              |        |        |
+-------------+-------------------------------------+--------+--------+
| 服务编号：  | 0x0b                                |        |        |
+-------------+-------------------------------------+--------+--------+
| 同步/异步： | 同步                                |        |        |
+-------------+-------------------------------------+--------+--------+
| 是          | 否                                  |        |        |
| 否可重入：  |                                     |        |        |
+-------------+-------------------------------------+--------+--------+
| 输入参数：  | id接收的N-SDU ID值                  | 值域： | 无     |
+-------------+-------------------------------------+--------+--------+
|             | Parameter（in）：请求读取的参数类型 | 值域： | 无     |
+-------------+-------------------------------------+--------+--------+
| 输入        | 无                                  |        |        |
| 输出参数：  |                                     |        |        |
+-------------+-------------------------------------+--------+--------+
| 输出参数：  | Value：请求读取的值                 |        |        |
+-------------+-------------------------------------+--------+--------+
| 返回值：    | Std_ReturnType E_OK ：成功          |        |        |
|             | E_NOT_OK： 不成功                   |        |        |
+-------------+-------------------------------------+--------+--------+
| 功能概述：  | 读取参数                            |        |        |
+-------------+-------------------------------------+--------+--------+

CanTp_MainFunction函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-------------------+---------+-------------------------+
| 函数名称：  | C                 |         |                         |
|             | anTp_MainFunction |         |                         |
+-------------+-------------------+---------+-------------------------+
| 函数原型：  | void              |         |                         |
|             | CanTp_M           |         |                         |
|             | ainFunction(void) |         |                         |
+-------------+-------------------+---------+-------------------------+
| 服务编号：  | 0x06              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 同步/异步： | 同步              |         |                         |
+-------------+-------------------+---------+-------------------------+
| 是          | 否                |         |                         |
| 否可重入：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输入参数：  | id                | 值域：  | 无                      |
+-------------+-------------------+---------+-------------------------+
| 输入        | 无                |         |                         |
| 输出参数：  |                   |         |                         |
+-------------+-------------------+---------+-------------------------+
| 输出参数：  | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 返回值：    | 无                |         |                         |
+-------------+-------------------+---------+-------------------------+
| 功能概述：  | CanTp模块主处理函 |         |                         |
|             | 数，异步处理任务  |         |                         |
|             | 均在这里进行处理  |         |                         |
+-------------+-------------------+---------+-------------------------+

CanTp_RxIndication函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+-----------------------------+-------+----------------+
| 函数名称：  | CanTp_RxIndication          |       |                |
+-------------+-----------------------------+-------+----------------+
| 函数原型：  | void                        |       |                |
|             | C                           |       |                |
|             | anTp_RxIndication(PduIdType |       |                |
|             | RxPduId, const              |       |                |
|             | PduInfoType\* PduInfoPtr)   |       |                |
+-------------+-----------------------------+-------+----------------+
| 服务编号：  | 0x42                        |       |                |
+-------------+-----------------------------+-------+----------------+
| 同步/异步： | 同步                        |       |                |
+-------------+-----------------------------+-------+----------------+
| 是          | 不同Pdu                     |       |                |
| 否可重入：  | Id可重入，同一PduId不可重入 |       |                |
+-------------+-----------------------------+-------+----------------+
| 输入参数：  | RxPduId：接收PDUID          | 值    | 无             |
|             |                             | 域：  |                |
+-------------+-----------------------------+-------+----------------+
|             | PduInfoPtr：数据信息指针    | 值    | 无             |
|             |                             | 域：  |                |
+-------------+-----------------------------+-------+----------------+
| 输入        | 无                          |       |                |
| 输出参数：  |                             |       |                |
+-------------+-----------------------------+-------+----------------+
| 输出参数：  | 无                          |       |                |
+-------------+-----------------------------+-------+----------------+
| 返回值：    | 无                          |       |                |
+-------------+-----------------------------+-------+----------------+
| 功能概述：  | CanTp模                     |       |                |
|             | 块接收函数，供CanIf模块调用 |       |                |
+-------------+-----------------------------+-------+----------------+

CanTp_TxConfirmation函数定义
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+-------------+----------------------------+------------+-------------+
| 函数名称：  | CanTp\_                    |            |             |
|             | TxConfirmation\            |            |             |
+-------------+----------------------------+------------+-------------+
| 函数原型：  | void                       |            |             |
|             | CanT                       |            |             |
|             | p_TxConfirmation(PduIdType |            |             |
|             | TxPduId)                   |            |             |
+-------------+----------------------------+------------+-------------+
| 服务编号：  | 0x40                       |            |             |
+-------------+----------------------------+------------+-------------+
| 同步/异步： | 同步                       |            |             |
+-------------+----------------------------+------------+-------------+
| 是          | 不同PduI                   |            |             |
| 否可重入：  | d可重入，同一PduId不可重入 |            |             |
+-------------+----------------------------+------------+-------------+
| 输入参数：  | TxPduId：发送PDUID值       | 值域：     | 无          |
+-------------+----------------------------+------------+-------------+
| 输入        | 无                         |            |             |
| 输出参数：  |                            |            |             |
+-------------+----------------------------+------------+-------------+
| 输出参数：  | 无                         |            |             |
+-------------+----------------------------+------------+-------------+
| 返回值：    | 无                         |            |             |
+-------------+----------------------------+------------+-------------+
| 功能概述：  | 发送确认函数               |            |             |
+-------------+----------------------------+------------+-------------+

可配置函数定义
--------------

无。

配置
====

CanTpGeneral
------------

|image6|

图 CanTpGeneral容器配置图

表 CanTpGeneral属性描述

+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|             UI名称            |    描述   |                                                 　                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|         CanTpConfigType       |  取值范围 |                                               PB/PC                                               | 默认取值 | PC_CONFIG |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  参数描述 |                                       控制CanTp模块配置权限                                       |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|     CanTpChangeParameterApi   |  取值范围 |                                             True/False                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  参数描述 |                                     改变接收参数的接口使能开关                                    |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  | PduRZeroCostOperation为FALSE时，此项默认使能且不可配置。PduRZeroCostOperation为TRUE时根据配置生成 |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 | TRUE      |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|      CanTpDevErrorDetect      |  参数描述 |                                            DET检查开关                                            |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|       CanTpDynIdSupport       |  参数描述 |                                   Metadata下的动态ID支持使能开关                                  |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|  CanTpFlexibleDataRateSupport |  参数描述 |                                        CAN   FD支持使能开关                                       |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
| CanTpGenericConnectionSupport |  参数描述 |                          对Metadata使用N-SDU处理通用连接的支持的使能开关                          |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                  CanTpDynIdSupport为TRUE时可配置                                  |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                               0-255                                               | 默认取值 |     0     |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|        CanTpPaddingByte       |  参数描述 |                                               填充值                                              |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|      CanTpReadParameterApi    |  取值范围 |                                             true/false                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  参数描述 |                                     读取接收参数的接口使能开关                                    |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|        CanTpVersionInfoApi    |  取值范围 |                                             true/false                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  参数描述 |                                     获取版本信息函数使能开关                                      |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             true/false                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|      CanTpDiagGWResEnable     |  参数描述 |                                诊断网关主动应答NRC78功能的使能开关                                |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             true/false                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|  CanTpSynchronousRxIndication |  参数描述 |         该参数设置为true时，表示同步RxIndication转发给PduR，否则将在mainfunction中异步处理        |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |      配置项CanTpDiagGatewayResponseEnable需在CanTpSynchronousRxIndication不勾选时才可以配置。     |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 | TRUE      |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|    CanTpRuntimeErrorDetect    |  参数描述 |                                       运行时错误DET检查开关                                       |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|          CanTpRxQueue         |  参数描述 |                                控制是否按接收顺序在主函数中依序处理                               |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                     Os/Callout/Tm/MainFunction                                    | 默认取值 |     无    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|         CanTpTimerType        |  参数描述 |                                            选择计时类型                                           |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               |  取值范围 |                                             True/False                                            | 默认取值 |   FALSE   |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|  CanTpSynchronousTransmission |  参数描述 |                             控制是否直接在CanTp_Transmit处理SF/FF发送                             |    　    |     　    |
|                               +-----------+---------------------------------------------------------------------------------------------------+----------+-----------+
|                               | 依赖关系  |                                                 无                                                |    　    |     　    |
+-------------------------------+-----------+---------------------------------------------------------------------------------------------------+----------+-----------+

CanTpConfig
-----------

|image7|

图 CanTpConfig容器配置图

表 CanTpConfig属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpMainFu  | 取值范围 | 0 .. 0.255       | 默认取值  | 0          |
| nctionPeriod |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 主函数调用周期   |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpM       | 取值范围 | 0 ..             | 默认取值  | 0          |
| axChannelCnt |          |                  |           |            |
|              |          | 1844             |           |            |
|              |          | 6744073709551615 |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 最大通道个数     |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 根               |           |            |
|              |          | 据该配置决定可配 |           |            |
|              |          | 的channel数量。  |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpChannel
~~~~~~~~~~~~

|image8|

图 CanTpChannel容器配置图

表 CanTpChannel属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanT         | 取值范围 | CANTP_M          | 默认取值  | CA         |
| pChannelMode |          | ODE_FULL_DUPLEX/ |           | NTP_MODE_F |
|              |          | CANTP_           |           | ULL_DUPLEX |
|              |          | MODE_HALF_DUPLEX |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 通道处理类型     |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| D            | 取值范围 | True/False       | 默认取值  | False      |
| iagGatewayRe |          |                  |           |            |
| sponseEnable |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 诊断             |           |            |
|              |          | 网关通道使能开关 |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | CanTpDia         |           |            |
|              |          | gGWResEnable使能 |           |            |
+--------------+----------+------------------+-----------+------------+
| DiagGatew    | 取值范围 | 0..1             | 默认取值  | 0.05       |
| ayResponseP2 |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 诊               |           |            |
|              |          | 断网关应答P2时间 |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | CanTpDia         |           |            |
|              |          | gGWResEnable使能 |           |            |
+--------------+----------+------------------+-----------+------------+
| D            | 取值范围 | 0..100           | 默认取值  | 5          |
| iagGatewayRe |          |                  |           |            |
| sponseP2Star |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 诊断             |           |            |
|              |          | 网关应答P2*时间  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | CanTpDia         |           |            |
|              |          | gGWResEnable使能 |           |            |
+--------------+----------+------------------+-----------+------------+
| D            | 取值范围 | 0..255           | 默认取值  | 0          |
| iagGatewayRe |          |                  |           |            |
| sponseMaxNum |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 应答             |           |            |
|              |          | NRC78的最大次数  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | CanTpDia         |           |            |
|              |          | gGWResEnable使能 |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpRxNSdu
^^^^^^^^^^^

|image9|

图 CanTpRxNSdu容器配置图

表 CanTpRxNSdu属性描述

+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
|          UI名称          |   描述   |                                      　                                     |    　    |           　           |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpBs                  | 取值范围 | 0 .. 255                                                                    | 默认取值 | 0                      |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | 块大小                                                                                                          |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpNar                 | 取值范围 | 0 .. INF                                                                    | 默认取值 | 0                      |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | N_Ar值                                                                                                          |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpNbr                 | 取值范围 | 0 .. INF                                                                    | 默认取值 | 0                      |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | N_Br值                                                                                                          |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpNcr                 | 取值范围 | 0 .. INF                                                                    | 默认取值 | 0                      |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | N_Cr值                                                                                                          |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpRxAddressingFormat  |          | CANTP_EXTENDED                                                              |          | CANTP_EXTENDED         |
|                          | 取值范围 +-----------------------------------------------------------------------------+ 默认取值 |                        |
|                          |          | /CANTP_MIXED/CANTP_MIXED29BIT/CANTP_NORMALFIXED/CANTP_STANDARD              |          |                        |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | 接收地址模式                                                                                                    |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpRxNSduId            | 取值范围 | 0 ... 65535                                                                 | 默认取值 | 无                     |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | 接收N-SDU ID值                                                                                                  |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpRxPaddingActivation | 取值范围 | CANTP_OFF/CANTP_ON                                                          | 默认取值 | CANTP_OFF              |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | 接收填充使能开关                                                                                                |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpRxTaType            | 取值范围 | CANTP_CANFD_FUNCTIONAL/CANTP_CANFD_PHYSICAL/CANTP_FUNCTIONAL/CANTP_PHYSICAL | 默认取值 | CANTP_CANFD_FUNCTIONAL |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | 接收TA类型                                                                                                      |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpRxWftMax            | 取值范围 | 0 ... 65535                                                                 | 默认取值 | 0                      |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | 接收等待FC最大次数                                                                                              |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpSTmin               | 取值范围 | 0 ... INF                                                                   | 默认取值 | 0                      |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | STmin值                                                                                                         |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------+----------+------------------------+
| CanTpRxNSduRef           | 取值范围 | 无                                                                          | 默认取值 | 无                     |
|                          +----------+-----------------------------------------------------------------------------+----------+------------------------+
|                          | 参数描述 | N-SDU关联                                                                                                       |
|                          +----------+-----------------------------------------------------------------------------------------------------------------+
|                          | 依赖关系 | 无                                                                                                              |
+--------------------------+----------+-----------------------------------------------------------------------------------------------------------------+

CanTpRxNPdu
'''''''''''

|image10|

图 CanTpRxNPdu容器配置图

表 CanTpRxNPdu属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| C            | 取值范围 | 0 ... 65535      | 默认取值  | 无         |
| anTpRxNPduId |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N-PDU ID值       |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 不可配置，根据   |           |            |
|              |          | 关联pdu自动生成  |           |            |
+--------------+----------+------------------+-----------+------------+
| Ca           | 取值范围 | 无               | 默认取值  | 无         |
| nTpRxNPduRef |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | PDU关联          |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpTxFcNPdu
'''''''''''''

|image11|

图 CanTpTxFcNPdu容器配置图

表 CanTpTxFcNPdu属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpT       | 取值范围 | 0 ...65535       | 默认取值  | 无         |
| xFcNPduConfi |          |                  |           |            |
| rmationPduId |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N-PDU ID值       |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 不可配置，根据   |           |            |
|              |          | 关联pdu自动生成  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanT         | 取值范围 | 无               | 默认取值  | 无         |
| pTxFcNPduRef |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | PDU关联          |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpNTa
''''''''

|image12|

图 CanTpNTa容器配置图

表 CanTpNTa属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNTa     | 取值范围 | 0 ... 255        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | TA值             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 地址             |           |            |
|              |          | 模式为CANTP_EXT  |           |            |
|              |          | ENDED的RxNSdu和T |           |            |
|              |          | xNSdu都必须配置. |           |            |
|              |          | 如               |           |            |
|              |          | 果DynIdSupport使 |           |            |
|              |          | 能,地址模式为CAN |           |            |
|              |          | TP_NORMALFIXED或 |           |            |
|              |          | CANTP_MIXED29BIT |           |            |
|              |          | 的               |           |            |
|              |          | RxNSdu必须配置。 |           |            |
|              |          | 如果DynIdSupport |           |            |
|              |          | 使能并且         |           |            |
|              |          | GenericConnecti  |           |            |
|              |          | onSupport不使能, |           |            |
|              |          | 且               |           |            |
|              |          | 地址模式为CANTP  |           |            |
|              |          | _NORMALFIXED或CA |           |            |
|              |          | NTP_MIXED29BIT的 |           |            |
|              |          | TxNSdu必须配置。 |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpNSa
''''''''

|image13|

图 CanTpNSa容器配置图

表 CanTpNSa属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNSa     | 取值范围 | 0 ... 255        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | SA值             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 地址模式为C      |           |            |
|              |          | ANTP_EXTENDED且T |           |            |
|              |          | A类型为CANTP_PHY |           |            |
|              |          | SICAL的RxNSdu和T |           |            |
|              |          | xNSdu都必须配置. |           |            |
|              |          | 如               |           |            |
|              |          | 果DynIdSupport使 |           |            |
|              |          | 能,地址模式为CAN |           |            |
|              |          | TP_NORMALFIXED或 |           |            |
|              |          | CANTP_MIXED29BIT |           |            |
|              |          | 的               |           |            |
|              |          | TxNSdu必须配置。 |           |            |
|              |          | 如果DynIdSupport |           |            |
|              |          | 使能并且         |           |            |
|              |          | GenericConnecti  |           |            |
|              |          | onSupport不使能, |           |            |
|              |          | 且               |           |            |
|              |          | 地址模式为CANTP  |           |            |
|              |          | _NORMALFIXED或CA |           |            |
|              |          | NTP_MIXED29BIT的 |           |            |
|              |          | RxNSdu必须配置。 |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpNAe
''''''''

|image14|

图 CanTpNAe容器配置图

表 CanTpNAe属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNAe     | 取值范围 | 0 ... 255        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | AE值             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 地               |           |            |
|              |          | 址模式为CANTP_M  |           |            |
|              |          | IXED或CANTP_MIXE |           |            |
|              |          | D29BIT的TxNSdu和 |           |            |
|              |          | RxNSdu必须配置。 |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpTxNSdu
^^^^^^^^^^^

|image15|

图 CanTpTxNSdu容器配置图

表 CanTpTxNSdu属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNas     | 取值范围 | 0 ... INF        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N_As值           |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNbs     | 取值范围 | 0 … INF          | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N_Bs             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNcs     | 取值范围 | 0 ... INF        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N_Cs             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpTc      | 取值范围 | True/False       | 默认取值  | 无         |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 取消接收和取     |           |            |
|              |          | 消发送的使能开关 |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 如果对应的CanTp  |           |            |
|              |          | TxNSdu/CanTpTxNS |           |            |
|              |          | duRef关联的PDU是 |           |            |
|              |          | PDUR某RoutingPat |           |            |
|              |          | h的DestPdu且对应 |           |            |
|              |          | 的SrcPdu被DCM的  |           |            |
|              |          | DcmDslProtocolTx |           |            |
|              |          | PduRef关联或直接 |           |            |
|              |          | 被DcmDslProtocol |           |            |
|              |          | TxPduRef关联的话 |           |            |
|              |          | ，CanTpTc配置项  |           |            |
|              |          | 不可自行配置，与 |           |            |
|              |          |                  |           |            |
|              |          | DcmG             |           |            |
|              |          | eneral/Preemptio |           |            |
|              |          | nProtocolCancelS |           |            |
|              |          | upport同步勾选； |           |            |
|              |          | 否则可自行配置。 |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpTxAddr  | 取值范围 | CANTP_EXTEND     | 默认取值  | CANT       |
| essingFormat |          | ED/CANTP_MIXED/C |           | P_EXTENDED |
|              |          | ANTP_MIXED29BIT/ |           |            |
|              |          | CANTP_NORMALFIXE |           |            |
|              |          | D/CANTP_STANDARD |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 发送地址模式     |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| C            | 取值范围 | 0 ... 65535      | 默认取值  | 无         |
| anTpTxNSduId |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 发送N-SDU ID值   |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 不可配，         |           |            |
|              |          | 根据pdu引用决定  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpTxPaddi | 取值范围 | CA               | 默认取值  | CANTP_OFF  |
| ngActivation |          | NTP_OFF/CANTP_ON |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 发送填充使能     |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| C            | 取值范围 | C                | 默认取值  | CANTP_     |
| anTpTxTaType |          | ANTP_FUNCTIONAL/ |           | FUNCTIONAL |
|              |          | CANTP_PHYSICAL   |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | 发送TA类型       |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+
| Ca           | 取值范围 | 无               | 默认取值  | 无         |
| nTpTxNSduRef |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | PDU关联          |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpTxNPdu
'''''''''''

|image16|

图 CanTpTxNPdu容器配置图

表 CanTpTxNPdu属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanT         | 取值范围 | 0 ... 65535      | 默认取值  | 0          |
| pTxNPduConfi |          |                  |           |            |
| rmationPduId |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N-PDU ID值       |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 不可配，         |           |            |
|              |          | 根据pdu引用决定  |           |            |
+--------------+----------+------------------+-----------+------------+
| Ca           | 取值范围 | 无               | 默认取值  | 无         |
| nTpTxNPduRef |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | PDU关联          |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+

CanTpRxFcNPdu
'''''''''''''

|image17|

图 CanTpRxFcNPdu容器配置图

表 CanTpRxFcNPdu属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| Can          | 取值范围 | 0 … 65535        | 默认取值  | 0          |
| TpRxFcNPduId |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | N-PDU ID值       |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 不可配，         |           |            |
|              |          | 根据pdu引用决定  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanT         | 取值范围 | 无               | 默认取值  | 无         |
| pRxFcNPduRef |          |                  |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | PDU关联          |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 无               |           |            |
+--------------+----------+------------------+-----------+------------+



CanTpNTa
''''''''

|image18|

图 CanTpNTa容器配置图

表 CanTpNTa属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNTa     | 取值范围 | 0 ... 255        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | TA值             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 地址             |           |            |
|              |          | 模式为CANTP_EXT  |           |            |
|              |          | ENDED的RxNSdu和T |           |            |
|              |          | xNSdu都必须配置. |           |            |
|              |          | 如               |           |            |
|              |          | 果DynIdSupport使 |           |            |
|              |          | 能,地址模式为CAN |           |            |
|              |          | TP_NORMALFIXED或 |           |            |
|              |          | CANTP_MIXED29BIT |           |            |
|              |          | 的               |           |            |
|              |          | RxNSdu必须配置。 |           |            |
|              |          | 如果DynIdSupport |           |            |
|              |          | 使能并且         |           |            |
|              |          | GenericConnecti  |           |            |
|              |          | onSupport不使能, |           |            |
|              |          | 且               |           |            |
|              |          | 地址模式为CANTP  |           |            |
|              |          | _NORMALFIXED或CA |           |            |
|              |          | NTP_MIXED29BIT的 |           |            |
|              |          | TxNSdu必须配置。 |           |            |
+--------------+----------+------------------+-----------+------------+



CanTpNSa
''''''''

|image19|

图 CanTpNSa容器配置图

表 CanTpNSa属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNSa     | 取值范围 | 0 ... 255        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | SA值             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 地址模式为C      |           |            |
|              |          | ANTP_EXTENDED且T |           |            |
|              |          | A类型为CANTP_PHY |           |            |
|              |          | SICAL的RxNSdu和T |           |            |
|              |          | xNSdu都必须配置. |           |            |
|              |          | 如               |           |            |
|              |          | 果DynIdSupport使 |           |            |
|              |          | 能,地址模式为CAN |           |            |
|              |          | TP_NORMALFIXED或 |           |            |
|              |          | CANTP_MIXED29BIT |           |            |
|              |          | 的               |           |            |
|              |          | TxNSdu必须配置。 |           |            |
|              |          | 如果DynIdSupport |           |            |
|              |          | 使能并且         |           |            |
|              |          | GenericConnecti  |           |            |
|              |          | onSupport不使能, |           |            |
|              |          | 且               |           |            |
|              |          | 地址模式为CANTP  |           |            |
|              |          | _NORMALFIXED或CA |           |            |
|              |          | NTP_MIXED29BIT的 |           |            |
|              |          | RxNSdu必须配置。 |           |            |
+--------------+----------+------------------+-----------+------------+



CanTpNAe
''''''''

|image20|

图 CanTpNAe容器配置图

表 CanTpNAe属性描述

+--------------+----------+------------------+-----------+------------+
| **UI名称**   | **描述** |                  |           |            |
+--------------+----------+------------------+-----------+------------+
| CanTpNAe     | 取值范围 | 0 ... 255        | 默认取值  | 0          |
+--------------+----------+------------------+-----------+------------+
|              | 参数描述 | AE值             |           |            |
+--------------+----------+------------------+-----------+------------+
|              | 依赖关系 | 地               |           |            |
|              |          | 址模式为CANTP_M  |           |            |
|              |          | IXED或CANTP_MIXE |           |            |
|              |          | D29BIT的TxNSdu和 |           |            |
|              |          | RxNSdu必须配置。 |           |            |
+--------------+----------+------------------+-----------+------------+

附录1
=====

[1]
通过CanTpTimerType配置项可以选择四种计时方法。分别为TM、OS、Mainfunction、Callout。TM:使用TM模块内部标准接口。OS：使用Os
system
counter。Mainfunction：依赖周期调度，由CanTp内部计时。不同计时方法的对应接口由配置工具生成在CanTp_Callout.c中，其中Callout是由客户自定义的计时类型，可以参照生成示例中TM/OS/Mainfunction的实现，结合项目工程情况修改接口自行实现计时功能。

[2] 根据整个通信栈架构，CanTp_TxConfirmation 接口目前按照422版本实现。

   [3]
   CanTpSynchronousTransmission配置项启用后，CanTp将在CanTp_Transmit接口中激活SF/FF帧的同步传输机制。需注意：若上层应用依赖CanTp_Transmit函数返回值进行后续处理，则该同步传输功能不可用。该功能仅适用于上层应用不依赖CanTp_Transmit函数返回值的场景。

附录2
=====

.. table:: 表 1 工程预编译宏定义表

   +----------------+-----------------+-----------------+-----------------+
   | 宏定义名称     | 功能            | 范              | 默认值          |
   |                |                 | 围（使用方法）  |                 |
   +----------------+-----------------+-----------------+-----------------+
   | CANTP\         | 接收过程中发送F | 定义：          | 未定义          |
   | _\ *FIX*\ \_BS | C所携带的BS取值 | B               |                 |
   |                |                 | S的数值使用配置 |                 |
   |                |                 | 的静态固定值；  |                 |
   |                |                 |                 |                 |
   |                |                 | 未定义：        |                 |
   |                |                 | B               |                 |
   |                |                 | S的数值采用动态 |                 |
   |                |                 | 自动计算的方式  |                 |
   +----------------+-----------------+-----------------+-----------------+
   |                |                 |                 |                 |
   +----------------+-----------------+-----------------+-----------------+

.. |image1| image:: ../../_static/参考手册/CanTp/image1.png
.. |image2| image:: ../../_static/参考手册/CanTp/image2.png
   :width: 3.35625in
   :height: 1.5in
.. |image3| image:: ../../_static/参考手册/CanTp/image3.png
   :width: 5.23403in
   :height: 5.8125in
.. |image4| image:: ../../_static/参考手册/CanTp/image4.png
   :width: 4.99938in
   :height: 3.83285in
.. |image5| image:: ../../_static/参考手册/CanTp/image5.png
   :width: 5.76736in
   :height: 3.24514in
.. |image6| image:: ../../_static/参考手册/CanTp/image6.png
   :width: 5.76736in
   :height: 4.18194in
.. |image7| image:: ../../_static/参考手册/CanTp/image7.png
   :width: 5.76736in
   :height: 1.95764in
.. |image8| image:: ../../_static/参考手册/CanTp/image8.png
   :width: 5.76736in
   :height: 3.56944in
.. |image9| image:: ../../_static/参考手册/CanTp/image9.png
   :width: 5.76736in
   :height: 3.53403in
.. |image10| image:: ../../_static/参考手册/CanTp/image10.png
   :width: 5.76736in
   :height: 3.51111in
.. |image11| image:: ../../_static/参考手册/CanTp/image11.png
   :width: 5.76736in
   :height: 3.44861in
.. |image12| image:: ../../_static/参考手册/CanTp/image12.png
   :width: 5.53125in
   :height: 0.78125in
.. |image13| image:: ../../_static/参考手册/CanTp/image13.png
   :width: 5.32292in
   :height: 0.78125in
.. |image14| image:: ../../_static/参考手册/CanTp/image14.png
   :width: 5.58333in
   :height: 0.85417in
.. |image15| image:: ../../_static/参考手册/CanTp/image15.png
   :width: 5.76736in
   :height: 3.46806in
.. |image16| image:: ../../_static/参考手册/CanTp/image16.png
   :width: 5.76736in
   :height: 3.45764in
.. |image17| image:: ../../_static/参考手册/CanTp/image17.png
   :width: 5.76736in
   :height: 3.51389in
.. |image18| image:: ../../_static/参考手册/CanTp/image12.png
   :width: 5.53125in
   :height: 0.78125in
.. |image19| image:: ../../_static/参考手册/CanTp/image13.png
   :width: 5.32292in
   :height: 0.78125in
.. |image20| image:: ../../_static/参考手册/CanTp/image14.png
   :width: 5.58333in
   :height: 0.85417in
